<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Moisture model · ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../GettingStarted/Terminology/">Terminology</a></li><li><a class="tocitem" href="../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><span class="tocitem">Tutorials</span></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../Common/UniversalFunctions/">Universal Functions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox" checked/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../TemperatureProfiles/">Temperature profiles</a></li><li><a class="tocitem" href="../AtmosReferenceState/">Reference profiles</a></li><li class="is-active"><a class="tocitem" href>Moisture model</a><ul class="internal"><li><a class="tocitem" href="#DryModel"><span>DryModel</span></a></li><li><a class="tocitem" href="#EquilMoist"><span>EquilMoist</span></a></li><li><a class="tocitem" href="#NonEquilMoist"><span>NonEquilMoist</span></a></li><li><a class="tocitem" href="#Implementation-notes"><span>Implementation notes</span></a></li></ul></li><li><a class="tocitem" href="../PrecipitationModelChoices/">Precipitation model</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-5-2" type="checkbox"/><label class="tocitem" for="menuitem-4-5-2"><span class="docs-label">DG methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Numerics/DGMethods/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-3" type="checkbox"/><label class="tocitem" for="menuitem-4-5-3"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-4" type="checkbox"/><label class="tocitem" for="menuitem-4-5-4"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Numerics/SystemSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Diagnostics/UsingDiagnostics/">Using Diagnostics</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/">Home</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Driver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Driver/">Top level interface</a></li><li><a class="tocitem" href="../../../APIs/Driver/Checkpoint/">Checkpoint</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../APIs/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../APIs/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../APIs/Atmos/TemperatureProfiles/">Temperature Profiles</a></li></ul></li><li><a class="tocitem" href="../../../APIs/Ocean/Ocean/">Ocean</a></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Land/LandModel/">Land Model</a></li><li><a class="tocitem" href="../../../APIs/Land/Runoff/">Runoff Parameterizations</a></li><li><a class="tocitem" href="../../../APIs/Land/SoilWaterParameterizations/">Soil Water Parameterizations</a></li><li><a class="tocitem" href="../../../APIs/Land/SoilHeatParameterizations/">Soil Heat Parameterizations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Common/Orientations/">Orientations</a></li><li><a class="tocitem" href="../../../APIs/Common/Spectra/">Spectra</a></li><li><a class="tocitem" href="../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../../APIs/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../APIs/Common/TurbulenceClosures/">Turbulence Closures</a></li><li><a class="tocitem" href="../../../APIs/Common/TurbulenceConvection/">Turbulence Convection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/BalanceLaws/BalanceLaws/">Balance Laws</a></li><li><a class="tocitem" href="../../../APIs/BalanceLaws/Problems/">Problems</a></li></ul></li><li><a class="tocitem" href="../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-9" type="checkbox"/><label class="tocitem" for="menuitem-5-9"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Diagnostics/Diagnostics/">Diagnostics groups</a></li><li><a class="tocitem" href="../../../APIs/Diagnostics/StateCheck/">State Check</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-10" type="checkbox"/><label class="tocitem" for="menuitem-5-10"><span class="docs-label">Input/Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-11" type="checkbox"/><label class="tocitem" for="menuitem-5-11"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../APIs/Numerics/SystemSolvers/SystemSolvers/">SystemSolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/DGMethods/">DG Methods</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/Courant/">Courant</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/NumericalFluxes/">Numerical Fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Utilities/VariableTemplates/">Variable Templates</a></li><li><a class="tocitem" href="../../../APIs/Utilities/SingleStackUtils/">Single Stack Utilities</a></li><li><a class="tocitem" href="../../../APIs/Utilities/TicToc/">Tic Toc</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Theory/Common/SurfaceFluxes/">SurfaceFluxes</a></li><li><a class="tocitem" href="../../../Theory/Common/Turbulence/">Turbulence Closures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Theory/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../Theory/Atmos/EDMF_plots/">EDMF Model</a></li><li><a class="tocitem" href="../../../Theory/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../Theory/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../Theory/Atmos/EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../../../Theory/Atmos/Model/tracers/">Tracers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../DevDocs/ModelVariableList/">Model variable list</a></li><li><a class="tocitem" href="../../../DevDocs/ModelOutput/">Model output</a></li><li><a class="tocitem" href="../../../DevDocs/DiagnosticVariableList/">Diagnostic variable list</a></li><li><a class="tocitem" href="../../../DevDocs/SystemImage/">Custom System Image</a></li></ul></li><li><a class="tocitem" href="../../../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How-to-guides</a></li><li><a class="is-disabled">Atmos</a></li><li class="is-active"><a href>Moisture model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Moisture model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/blob/master/docs/src/HowToGuides/Atmos/MoistureModelChoices.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Moisture-model-choices-in-Atmos.jl"><a class="docs-heading-anchor" href="#Moisture-model-choices-in-Atmos.jl">Moisture model choices in Atmos.jl</a><a id="Moisture-model-choices-in-Atmos.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Moisture-model-choices-in-Atmos.jl" title="Permalink"></a></h1><p>The moisture model in <code>Atmos.jl</code> describes the behavior   of suspended water in the atmosphere (i.e. water vapor,   cloud liquid water and cloud ice). There are three options available: <code>DryModel</code>, <code>EquilMoist</code> and <code>NonEquilMoist</code>.</p><h2 id="DryModel"><a class="docs-heading-anchor" href="#DryModel">DryModel</a><a id="DryModel-1"></a><a class="docs-heading-anchor-permalink" href="#DryModel" title="Permalink"></a></h2><p>The <code>DryModel</code> assumes that air is dry and there is no water available   in any form. It does not add any water related variables to state variables.</p><h2 id="EquilMoist"><a class="docs-heading-anchor" href="#EquilMoist">EquilMoist</a><a id="EquilMoist-1"></a><a class="docs-heading-anchor-permalink" href="#EquilMoist" title="Permalink"></a></h2><p>The <code>EquilMoist</code> assumes that water is present in the air and that   all of its phases are always in thermodynamic equilibrium. It employs an iterative search algorithm called <code>saturation adjustment</code> to find   the temperature at which all water phases are in equilibrium   and the corresponding <code>q_liq</code> and <code>q_ice</code>   (cloud liquid water cloud ice specific humidities). It adds <code>ρ q_tot</code> (air density times total water specific humidity)    to state variables. The <code>q_liq</code> and <code>q_ice</code> are diagnosed during output based on the temperature   stored in the auxiliary state.</p><h2 id="NonEquilMoist"><a class="docs-heading-anchor" href="#NonEquilMoist">NonEquilMoist</a><a id="NonEquilMoist-1"></a><a class="docs-heading-anchor-permalink" href="#NonEquilMoist" title="Permalink"></a></h2><p>The <code>NonEquilMoist</code> assumes that water is present in the air,   its phases are in thermal equilibrium (i.e., they have the same temperature),   but it does not assume that the partitioning of water   into its vapor, liquid, and ice phases is in equilibrium. At each time step, the cloud liquid water and cloud ice source/sink terms   are obtained as relaxation towards equilibrium over time scale   that may eventually depend on factors such as the number of cloud condensation nuclei.   (for details see <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Cloud-water-condensation/evaporation">here</a>.) This approach does not require employing iterative algorithm and   allows for supersaturation to be present in the computational domain. It adds <code>ρ q_tot</code>, <code>ρ q_liq</code> and <code>ρ q_ice</code> to the state variables   (air density times total water, cloud liquid water and cloud ice specific humidities). Because the assumed relaxation timescale for condensation/evaporation and   deposition/sublimation is small, it requires care when choosing the   model timestep length.</p><h2 id="Implementation-notes"><a class="docs-heading-anchor" href="#Implementation-notes">Implementation notes</a><a id="Implementation-notes-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-notes" title="Permalink"></a></h2><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p>While <code>recover_thermo_state</code> is an ideal long-term solution, right now we are directly calling new<em>thermo</em>state to avoid inconsistent aux states in kernels where the aux states are out of sync with the boundary state.</p></div></div><p>The moisture models rely on the   <a href="https://clima.github.io/ClimateMachine.jl/latest/APIs/Atmos/AtmosModel/#ClimateMachine.Atmos.new_thermo_state">new_thermo_state</a>   and   <a href="https://clima.github.io/ClimateMachine.jl/latest/APIs/Atmos/AtmosModel/#ClimateMachine.Atmos.recover_thermo_state">recover_thermo_state</a>   convenience functions to create a <code>struct</code> that stores   air properties needed to uniquely define air thermodynamic state. For the <code>DryModel</code> it is the   <a href="https://clima.github.io/ClimateMachine.jl/latest/APIs/Common/Thermodynamics/#ClimateMachine.Thermodynamics.PhaseDry">PhaseDry</a>   <code>struct</code> that has three fields:   parameter set used by the <code>Atmos.jl</code> model, internal energy and air density. For the <code>EquilMoist</code> model it is the   <a href="https://clima.github.io/ClimateMachine.jl/latest/APIs/Common/Thermodynamics/#ClimateMachine.Thermodynamics.PhaseEquil">PhaseEquil</a>   <code>struct</code> that has five fields:   parameter set used by the <code>Atmos.jl</code> model, internal energy, air density,   total water specific humidity and temperature at which all water phases   are in equilibrium. For the <code>NonEquilMoist</code> model it is the   <a href="https://clima.github.io/ClimateMachine.jl/latest/APIs/Common/Thermodynamics/#ClimateMachine.Thermodynamics.PhaseNonEquil">PhaseNonEquil</a>   <code>struct</code> that has four fields:   parameter set used by the <code>Atmos.jl</code> model, internal energy,   air density and phase partition <code>struct</code>. All other properties, such as the speed of sound in the air,   water vapor specific humidity,   etc, should be computed based on the thermodynamic state <code>struct</code>.</p><p>The <code>new_thermo_state</code> function is called at the beginning of each time step   in the <code>atmos_nodal_update_auxiliary_state</code> function. For the <code>EquilMoist</code> model the <code>new_thermo_state</code> function calls   the <code>saturation_adjustment</code> to find the equilibrium temperature. It populates the fields of the <code>PhaseEquil</code> <code>struct</code>   and saves the equilibrium air temperature into the auxiliary state. For the <code>DryModel</code> and <code>NonEquilMoist</code> model the thermodynamic state <code>struct</code>   is created based on the current state variables. The <code>recover_thermo_state</code> function should be used throughout the code to create   an instance of the thermodynamic state <code>struct</code>. For the <code>EquilMoist</code> model it populates the <code>PhaseEquil</code> fields based on the   current state variables and the temperature stored in the auxiliary state. This avoids executing unnecessarily the <code>saturation_adjustemnt</code> algorithm. For the <code>DryModel</code> and <code>NonEquilMoist</code> model the <code>recover_thermo_state</code>   function is the same as the <code>new_thermo_state</code> function   and populates the corresponding <code>struct</code> fields based on   the current state variables.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../AtmosReferenceState/">« Reference profiles</a><a class="docs-footer-nextpage" href="../PrecipitationModelChoices/">Precipitation model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 15 December 2020 04:29">Tuesday 15 December 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

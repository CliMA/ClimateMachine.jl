<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>How to make a balance law · ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../../GettingStarted/Terminology/">Terminology</a></li><li><a class="tocitem" href="../../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><span class="tocitem">Tutorials</span></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../Common/UniversalFunctions/">Universal Functions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Atmos/TemperatureProfiles/">Temperature profiles</a></li><li><a class="tocitem" href="../../../Atmos/AtmosReferenceState/">Reference profiles</a></li><li><a class="tocitem" href="../../../Atmos/MoistureModelChoices/">Moisture model</a></li><li><a class="tocitem" href="../../../Atmos/PrecipitationModelChoices/">Precipitation model</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox" checked/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-5-2" type="checkbox" checked/><label class="tocitem" for="menuitem-4-5-2"><span class="docs-label">DG methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>How to make a balance law</a><ul class="internal"><li><a class="tocitem" href="#Variable-name-specification-methods"><span>Variable name specification methods</span></a></li><li><a class="tocitem" href="#Methods-to-compute-gradients-and-integrals"><span>Methods to compute gradients and integrals</span></a></li><li><a class="tocitem" href="#Methods-to-compute-fluxes-and-sources"><span>Methods to compute fluxes and sources</span></a></li><li><a class="tocitem" href="#Methods-to-compute-numerical-fluxes"><span>Methods to compute numerical fluxes</span></a></li><li><a class="tocitem" href="#Methods-to-set-initial-conditions"><span>Methods to set initial conditions</span></a></li><li><a class="tocitem" href="#General-Remarks"><span>General Remarks</span></a></li><li class="toplevel"><a class="tocitem" href="#Reference-links"><span>Reference links</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-3" type="checkbox"/><label class="tocitem" for="menuitem-4-5-3"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-4" type="checkbox"/><label class="tocitem" for="menuitem-4-5-4"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../SystemSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Diagnostics/UsingDiagnostics/">Using Diagnostics</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/">Home</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Driver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Driver/">Top level interface</a></li><li><a class="tocitem" href="../../../../APIs/Driver/Checkpoint/">Checkpoint</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../APIs/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../../APIs/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../../APIs/Atmos/TemperatureProfiles/">Temperature Profiles</a></li></ul></li><li><a class="tocitem" href="../../../../APIs/Ocean/Ocean/">Ocean</a></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Land/LandModel/">Land Model</a></li><li><a class="tocitem" href="../../../../APIs/Land/Runoff/">Runoff Parameterizations</a></li><li><a class="tocitem" href="../../../../APIs/Land/SoilWaterParameterizations/">Soil Water Parameterizations</a></li><li><a class="tocitem" href="../../../../APIs/Land/SoilHeatParameterizations/">Soil Heat Parameterizations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Common/Orientations/">Orientations</a></li><li><a class="tocitem" href="../../../../APIs/Common/Spectra/">Spectra</a></li><li><a class="tocitem" href="../../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../../../APIs/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../../APIs/Common/TurbulenceClosures/">Turbulence Closures</a></li><li><a class="tocitem" href="../../../../APIs/Common/TurbulenceConvection/">Turbulence Convection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/BalanceLaws/BalanceLaws/">Balance Laws</a></li><li><a class="tocitem" href="../../../../APIs/BalanceLaws/Problems/">Problems</a></li></ul></li><li><a class="tocitem" href="../../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-9" type="checkbox"/><label class="tocitem" for="menuitem-5-9"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Diagnostics/Diagnostics/">Diagnostics groups</a></li><li><a class="tocitem" href="../../../../APIs/Diagnostics/StateCheck/">State Check</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-10" type="checkbox"/><label class="tocitem" for="menuitem-5-10"><span class="docs-label">Input/Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-11" type="checkbox"/><label class="tocitem" for="menuitem-5-11"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../../APIs/Numerics/SystemSolvers/SystemSolvers/">SystemSolvers</a></li><li><a class="tocitem" href="../../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../../APIs/Numerics/DGMethods/DGMethods/">DG Methods</a></li><li><a class="tocitem" href="../../../../APIs/Numerics/DGMethods/Courant/">Courant</a></li><li><a class="tocitem" href="../../../../APIs/Numerics/DGMethods/NumericalFluxes/">Numerical Fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Utilities/VariableTemplates/">Variable Templates</a></li><li><a class="tocitem" href="../../../../APIs/Utilities/SingleStackUtils/">Single Stack Utilities</a></li><li><a class="tocitem" href="../../../../APIs/Utilities/TicToc/">Tic Toc</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Theory/Common/SurfaceFluxes/">SurfaceFluxes</a></li><li><a class="tocitem" href="../../../../Theory/Common/Turbulence/">Turbulence Closures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Theory/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../Theory/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../../Theory/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../../Theory/Atmos/EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../../../../Theory/Atmos/Model/tracers/">Tracers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../../DevDocs/ModelVariableList/">Model variable list</a></li><li><a class="tocitem" href="../../../../DevDocs/ModelOutput/">Model output</a></li><li><a class="tocitem" href="../../../../DevDocs/DiagnosticVariableList/">Diagnostic variable list</a></li><li><a class="tocitem" href="../../../../DevDocs/SystemImage/">Custom System Image</a></li></ul></li><li><a class="tocitem" href="../../../../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How-to-guides</a></li><li><a class="is-disabled">Numerics</a></li><li><a class="is-disabled">DG methods</a></li><li class="is-active"><a href>How to make a balance law</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>How to make a balance law</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/blob/master/docs/src/HowToGuides/Numerics/DGMethods/how_to_make_a_balance_law.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-make-a-Balance-law"><a class="docs-heading-anchor" href="#How-to-make-a-Balance-law">How to make a Balance law</a><a id="How-to-make-a-Balance-law-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-make-a-Balance-law" title="Permalink"></a></h1><p>Defining the set of solved PDEs in ClimateMachine revolve around defining a <a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.BalanceLaw"><code>BalanceLaw</code></a>. A balance law solves equations of the form:</p><pre><code class="language-none">∂Y
-- = - ∇ • ( F_{first_order}(Y) + F_{second_order}(Y, Σ) ) + S_{non_conservative}(Y, Σ)
∂t</code></pre><p>Here, <code>Y</code>, <code>Σ</code>, <code>F_{first_order}</code>, <code>F_{second_order}</code>, and <code>S_{non_conservative}</code> can be thought of column vectors<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> expressing:</p><ul><li><p><code>Y</code> the prognostic state variables, or unknowns of the PDEs to be solved</p></li><li><p><code>Σ</code> the gradients of functions of the prognostic state variables</p></li><li><p><code>F_{first-order}</code> contains all first-order fluxes (e.g. <strong>not</strong> functions</p></li></ul><p>of gradients of any variables)</p><ul><li><code>F_{second-order}</code> contains all second-order and higher-order fluxes</li></ul><p>(e.g. functions of gradients of any variables)</p><ul><li><code>S_{non_conservative}</code> non-conservative sources<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup></li></ul><p>In order to alleviate users from being concerned with the burden of spatial discretization, users must provide their own implementations of the following methods, which are computed locally at each nodal point:</p><h2 id="Variable-name-specification-methods"><a class="docs-heading-anchor" href="#Variable-name-specification-methods">Variable name specification methods</a><a id="Variable-name-specification-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-name-specification-methods" title="Permalink"></a></h2><p>The <code>vars_state</code> method is used to specify the names of the variables for the following state variable types:</p><table><tr><th style="text-align: left"><strong>Type</strong></th><th style="text-align: left">Purpose</th></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.Prognostic"><code>Prognostic</code></a></td><td style="text-align: left">the variables in the prognostic state vector, typically mass, momentum, and various tracers.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.Auxiliary"><code>Auxiliary</code></a></td><td style="text-align: left">any variables required for the balance law that aren&#39;t related to derivatives of the state variables (e.g. spatial coordinates or various integrals) or those needed to solve expensive auxiliary equations (e.g., temperature via a non-linear equation solve)</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.Gradient"><code>Gradient</code></a></td><td style="text-align: left">the gradients of functions of the prognostic state variables. used to represent values before <strong>and</strong> after differentiation</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.GradientFlux"><code>GradientFlux</code></a></td><td style="text-align: left">the gradient fluxes necessary to impose Neumann boundary conditions. typically the product of a diffusivity tensor with a gradient state variable, potentially equivalent to the second-order flux for a prognostic state variable</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.UpwardIntegrals"><code>UpwardIntegrals</code></a></td><td style="text-align: left">any one-dimensional vertical integrals from <strong>bottom to top</strong> of the domain required for the balance law. used to represent both the integrand <strong>and</strong> the resulting indefinite integral</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.DownwardIntegrals"><code>DownwardIntegrals</code></a></td><td style="text-align: left">any one-dimensional vertical integral from <strong>top to bottom</strong> of the domain required for the balance law. each variable here must also exist in <code>vars_state</code> since the reverse integral kernels use subtraction to reverse the integral instead of performing a new integral. use to represent the value before <strong>and</strong> after reversing direction</td></tr></table><h2 id="Methods-to-compute-gradients-and-integrals"><a class="docs-heading-anchor" href="#Methods-to-compute-gradients-and-integrals">Methods to compute gradients and integrals</a><a id="Methods-to-compute-gradients-and-integrals-1"></a><a class="docs-heading-anchor-permalink" href="#Methods-to-compute-gradients-and-integrals" title="Permalink"></a></h2><table><tr><th style="text-align: left"><strong>Method</strong></th><th style="text-align: left">Purpose</th></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.compute_gradient_argument!"><code>compute_gradient_argument!</code></a></td><td style="text-align: left">specify how to compute the arguments to the gradients. can be functions of prognostic state  and auxiliary variables.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.compute_gradient_flux!"><code>compute_gradient_flux!</code></a></td><td style="text-align: left">specify how to compute gradient fluxes. can be a functions of the gradient state, the prognostic state, and auxiliary variables.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.integral_load_auxiliary_state!"><code>integral_load_auxiliary_state!</code></a></td><td style="text-align: left">specify how to compute integrands. can be functions of the prognostic state and auxiliary variables.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.integral_set_auxiliary_state!"><code>integral_set_auxiliary_state!</code></a></td><td style="text-align: left">specify which auxiliary variables are used to store the output of the integrals.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.reverse_integral_load_auxiliary_state!"><code>reverse_integral_load_auxiliary_state!</code></a></td><td style="text-align: left">specify auxiliary variables need their integrals reversed.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.reverse_integral_set_auxiliary_state!"><code>reverse_integral_set_auxiliary_state!</code></a></td><td style="text-align: left">specify which auxiliary variables are used to store the output of the reversed integrals.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.update_auxiliary_state!"><code>update_auxiliary_state!</code></a></td><td style="text-align: left">perform any updates to the auxiliary variables needed at the beginning of each time-step. Can be used to solve non-linear equations, calculate integrals, and apply filters.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.update_auxiliary_state_gradient!"><code>update_auxiliary_state_gradient!</code></a></td><td style="text-align: left">same as above, but after computing gradients and gradient fluxes in case these variables are needed during the update.</td></tr></table><h2 id="Methods-to-compute-fluxes-and-sources"><a class="docs-heading-anchor" href="#Methods-to-compute-fluxes-and-sources">Methods to compute fluxes and sources</a><a id="Methods-to-compute-fluxes-and-sources-1"></a><a class="docs-heading-anchor-permalink" href="#Methods-to-compute-fluxes-and-sources" title="Permalink"></a></h2><table><tr><th style="text-align: left"><strong>Method</strong></th><th style="text-align: left">Purpose</th></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.flux_first_order!"><code>flux_first_order!</code></a></td><td style="text-align: left">specify <code>F_{first_order}</code> for each prognostic state variable. can be functions of the prognostic state and auxiliary variables.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.flux_second_order!"><code>flux_second_order!</code></a></td><td style="text-align: left">specify <code>F_{second_order}</code> for each prognostic state variable. can be functions of the prognostic state, gradient flux state, and auxiliary variables.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.source!"><code>source!</code></a></td><td style="text-align: left">specify <code>S_{non_conservative}</code>  for each prognostic state variable. can be functions of the prognostic state, gradient flux state, and auxiliary variables.</td></tr></table><h2 id="Methods-to-compute-numerical-fluxes"><a class="docs-heading-anchor" href="#Methods-to-compute-numerical-fluxes">Methods to compute numerical fluxes</a><a id="Methods-to-compute-numerical-fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Methods-to-compute-numerical-fluxes" title="Permalink"></a></h2><table><tr><th style="text-align: left"><strong>Method</strong></th><th style="text-align: left">Purpose</th></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.wavespeed"><code>wavespeed</code></a></td><td style="text-align: left">specify how to compute the local wavespeed if using the <code>RusanovNumericalFlux</code>.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.boundary_state!"><code>boundary_state!</code></a></td><td style="text-align: left">define exterior nodal values of the prognostic state and gradient flux state used to compute the numerical boundary fluxes.</td></tr></table><h2 id="Methods-to-set-initial-conditions"><a class="docs-heading-anchor" href="#Methods-to-set-initial-conditions">Methods to set initial conditions</a><a id="Methods-to-set-initial-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Methods-to-set-initial-conditions" title="Permalink"></a></h2><table><tr><th style="text-align: left"><strong>Method</strong></th><th style="text-align: left">Purpose</th></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.init_state_prognostic!"><code>init_state_prognostic!</code></a></td><td style="text-align: left">provide initial values for the prognostic state as a function of time and space.</td></tr><tr><td style="text-align: left"><a href="../../../../APIs/BalanceLaws/BalanceLaws/#ClimateMachine.BalanceLaws.init_state_auxiliary!"><code>init_state_auxiliary!</code></a></td><td style="text-align: left">provide initial values for the auxiliary variables as a function of the geometry.</td></tr></table><h2 id="General-Remarks"><a class="docs-heading-anchor" href="#General-Remarks">General Remarks</a><a id="General-Remarks-1"></a><a class="docs-heading-anchor-permalink" href="#General-Remarks" title="Permalink"></a></h2><p>While <code>Y</code> can be thought of a column vector (each <em>row</em> of which corresponds to each state variable and its prognostic equation), the <em>second</em> function argument inside these methods behave as dictionaries, for example:</p><pre><code class="language-julia">struct MyModel &lt;: BalanceLaw end

function vars_state(m::MyModel, ::Prognostic, FT)
    @vars begin
        ρ::FT
        T::FT
    end
end

function source!(m::MyModel, source::Vars, args...)
    source.ρ = 1 # adds a source of 1 to RHS of ρ equation
    source.T = 1 # adds a source of 1 to RHS of T equation
end</code></pre><p>All equations are marched simultaneously in time.</p><h1 id="Reference-links"><a class="docs-heading-anchor" href="#Reference-links">Reference links</a><a id="Reference-links-1"></a><a class="docs-heading-anchor-permalink" href="#Reference-links" title="Permalink"></a></h1><p>as this can leak conservation of the unknowns and lead to numerical instabilities. It is recommended to use either <code>F_{diffusive}</code> or <code>F_{non_diffusive}</code>, as these fluxes are communicated across elements<sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup></p><p>where there may be many [Gauss-Lobatto]<sup class="footnote-reference"><a id="citeref-4" href="#footnote-4">[4]</a></sup> points</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a><a href="https://en.wikipedia.org/wiki/Row_and_column_vectors">Column Vectors</a></li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Note that using non-conservative sources should be a final resort,</li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a>MPI communication occurs only across elements, not within each element,</li><li class="footnote" id="footnote-4"><a class="tag is-link" href="#citeref-4">4</a><a href="https://en.wikipedia.org/wiki/Gaussian_quadrature#Gauss%E2%80%93Lobatto_rules">Gauss-Lobatto</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../Atmos/PrecipitationModelChoices/">« Precipitation model</a><a class="docs-footer-nextpage" href="../../ODESolvers/Timestepping/">Time-integration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 7 December 2020 19:44">Monday 7 December 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

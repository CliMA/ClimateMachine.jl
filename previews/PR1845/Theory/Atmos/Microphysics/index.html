<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Microphysics · ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../GettingStarted/Terminology/">Terminology</a></li><li><a class="tocitem" href="../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><span class="tocitem">Tutorials</span></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../HowToGuides/Common/UniversalFunctions/">Universal Functions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Atmos/TemperatureProfiles/">Temperature profiles</a></li><li><a class="tocitem" href="../../../HowToGuides/Atmos/AtmosReferenceState/">Reference profiles</a></li><li><a class="tocitem" href="../../../HowToGuides/Atmos/MoistureModelChoices/">Moisture model</a></li><li><a class="tocitem" href="../../../HowToGuides/Atmos/PrecipitationModelChoices/">Precipitation model</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-5-2" type="checkbox"/><label class="tocitem" for="menuitem-4-5-2"><span class="docs-label">DG methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/DGMethods/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-3" type="checkbox"/><label class="tocitem" for="menuitem-4-5-3"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-4" type="checkbox"/><label class="tocitem" for="menuitem-4-5-4"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/SystemSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Diagnostics/UsingDiagnostics/">Using Diagnostics</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/">Home</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Driver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Driver/">Top level interface</a></li><li><a class="tocitem" href="../../../APIs/Driver/Checkpoint/">Checkpoint</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../APIs/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../APIs/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../APIs/Atmos/TemperatureProfiles/">Temperature Profiles</a></li></ul></li><li><a class="tocitem" href="../../../APIs/Ocean/Ocean/">Ocean</a></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Land/LandModel/">Land Model</a></li><li><a class="tocitem" href="../../../APIs/Land/Runoff/">Runoff Parameterizations</a></li><li><a class="tocitem" href="../../../APIs/Land/SoilWaterParameterizations/">Soil Water Parameterizations</a></li><li><a class="tocitem" href="../../../APIs/Land/SoilHeatParameterizations/">Soil Heat Parameterizations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Common/Orientations/">Orientations</a></li><li><a class="tocitem" href="../../../APIs/Common/Spectra/">Spectra</a></li><li><a class="tocitem" href="../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../../APIs/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../APIs/Common/TurbulenceClosures/">Turbulence Closures</a></li><li><a class="tocitem" href="../../../APIs/Common/TurbulenceConvection/">Turbulence Convection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/BalanceLaws/BalanceLaws/">Balance Laws</a></li><li><a class="tocitem" href="../../../APIs/BalanceLaws/Problems/">Problems</a></li></ul></li><li><a class="tocitem" href="../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-9" type="checkbox"/><label class="tocitem" for="menuitem-5-9"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Diagnostics/Diagnostics/">Diagnostics groups</a></li><li><a class="tocitem" href="../../../APIs/Diagnostics/StateCheck/">State Check</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-10" type="checkbox"/><label class="tocitem" for="menuitem-5-10"><span class="docs-label">Input/Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-11" type="checkbox"/><label class="tocitem" for="menuitem-5-11"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../APIs/Numerics/SystemSolvers/SystemSolvers/">SystemSolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/DGMethods/">DG Methods</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/Courant/">Courant</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/NumericalFluxes/">Numerical Fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Utilities/VariableTemplates/">Variable Templates</a></li><li><a class="tocitem" href="../../../APIs/Utilities/SingleStackUtils/">Single Stack Utilities</a></li><li><a class="tocitem" href="../../../APIs/Utilities/TicToc/">Tic Toc</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox" checked/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Common/SurfaceFluxes/">SurfaceFluxes</a></li><li><a class="tocitem" href="../../Common/Turbulence/">Turbulence Closures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox" checked/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../EDMF_plots/">EDMF Model</a></li><li><a class="tocitem" href="../Microphysics_0M/">Microphysics_0M</a></li><li class="is-active"><a class="tocitem" href>Microphysics</a><ul class="internal"><li><a class="tocitem" href="#Assumed-particle-size-relationships"><span>Assumed particle size relationships</span></a></li><li><a class="tocitem" href="#Assumed-particle-size-distributions"><span>Assumed particle size distributions</span></a></li><li><a class="tocitem" href="#Parameterized-processes"><span>Parameterized processes</span></a></li><li><a class="tocitem" href="#Ventilation-factor"><span>Ventilation factor</span></a></li><li><a class="tocitem" href="#Terminal-velocity"><span>Terminal velocity</span></a></li><li><a class="tocitem" href="#Cloud-water-condensation/evaporation"><span>Cloud water condensation/evaporation</span></a></li><li><a class="tocitem" href="#Cloud-ice-deposition/sublimation"><span>Cloud ice deposition/sublimation</span></a></li><li><a class="tocitem" href="#Rain-autoconversion"><span>Rain autoconversion</span></a></li><li><a class="tocitem" href="#Snow-autoconversion"><span>Snow autoconversion</span></a></li><li><a class="tocitem" href="#Accretion"><span>Accretion</span></a></li><li><a class="tocitem" href="#Rain-evaporation-and-snow-sublimation"><span>Rain evaporation and snow sublimation</span></a></li><li><a class="tocitem" href="#Snow-melt"><span>Snow melt</span></a></li><li><a class="tocitem" href="#Coupling-to-the-state-variables"><span>Coupling to the state variables</span></a></li><li><a class="tocitem" href="#Example-figures"><span>Example figures</span></a></li></ul></li><li><a class="tocitem" href="../EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../Model/tracers/">Tracers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../DevDocs/ModelVariableList/">Model variable list</a></li><li><a class="tocitem" href="../../../DevDocs/ModelOutput/">Model output</a></li><li><a class="tocitem" href="../../../DevDocs/DiagnosticVariableList/">Diagnostic variable list</a></li><li><a class="tocitem" href="../../../DevDocs/SystemImage/">Custom System Image</a></li></ul></li><li><a class="tocitem" href="../../../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li><a class="is-disabled">Atmos</a></li><li class="is-active"><a href>Microphysics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Microphysics</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/blob/master/docs/src/Theory/Atmos/Microphysics.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Microphysics"><a class="docs-heading-anchor" href="#Microphysics">Microphysics</a><a id="Microphysics-1"></a><a class="docs-heading-anchor-permalink" href="#Microphysics" title="Permalink"></a></h1><p>The <code>Microphysics.jl</code> module describes a 1-moment bulk parameterization of   cloud microphysical processes. The module is based on the ideas of   <a href="../../../References/#Kessler1995">Edwin Kessler  (1995)</a>,   <a href="../../../References/#Grabowski1998">Wojciech W Grabowski  (1998)</a>   and <a href="../../../References/#Kaul2015">Colleen M Kaul , Jo { \~a } o Teixeira , Kentaroh Suzuki  (2015)</a>.</p><p>The cloud microphysics variables are expressed as specific humidities:</p><ul><li><code>q_tot</code> - total water specific humidity,</li><li><code>q_vap</code> - water vapor specific humidity,</li><li><code>q_liq</code> - cloud water specific humidity,</li><li><code>q_ice</code> - cloud ice specific humidity,</li><li><code>q_rai</code> - rain specific humidity,</li><li><code>q_sno</code> - snow specific humidity.</li></ul><h2 id="Assumed-particle-size-relationships"><a class="docs-heading-anchor" href="#Assumed-particle-size-relationships">Assumed particle size relationships</a><a id="Assumed-particle-size-relationships-1"></a><a class="docs-heading-anchor-permalink" href="#Assumed-particle-size-relationships" title="Permalink"></a></h2><p>Particles are assumed to follow mass(radius), cross section(radius), and   terminal velocity(radius) relationships defined as power laws. The coefficients are defined in the   <a href="https://github.com/CliMA/CLIMAParameters.jl">CLIMAParameters.jl</a> package   and are shown in the table below. For rain and ice they correspond to spherical liquid water drops   and ice particles, respectively. There is no assumed particle shape for snow, and the relationships are   empirical.</p><p class="math-container">\[m(r) = \chi_m \, m_0 \left(\frac{r}{r_0}\right)^{m_e + \Delta_m}\]</p><p class="math-container">\[a(r) = \chi_a \, a_0 \left(\frac{r}{r_0}\right)^{a_e + \Delta_a}\]</p><p class="math-container">\[v_{term}(r) = \chi_v \, v_0 \left(\frac{r}{r_0}\right)^{v_e + \Delta_v}\]</p><p>where:</p><ul><li><span>$r$</span> is the particle radius,</li><li><span>$r_0$</span> is the typical particle radius used to nondimensionalize,</li><li><span>$m_0, \, m_e, \, a_0, \, a_e, \, v_0, \, v_e \,$</span> are the default coefficients,</li><li><span>$\chi_m$</span>, <span>$\Delta_m$</span>, <span>$\chi_a$</span>, <span>$\Delta_a$</span>, <span>$\chi_v$</span>, <span>$\Delta_v$</span> are the coefficients that can be used during model calibration to expand around the default values. Without calibration all <span>$\chi$</span> parameters are set to 1 and all <span>$\Delta$</span> parameters are set to 0.</li></ul><p>The above coefficients, similarly to all other microphysics parameters,   are not hardcoded in the final microphysics parameterizations. The goal is to allow easy flexibility when calibrating the scheme. With that said, the assumption about the shape of the particles is used three   times when deriving the microphysics formulae:</p><ul><li>The mass transfer equation (\ref{eq:mass_rate}) used in snow autoconversion, rain evaporation, snow sublimation and snow melt rates is derived assuming spherical particle shapes. To correct for non-spherical shape it should be multiplied by a function of the particle aspect ratio.</li><li>The geometric collision kernel used for deriving rain-snow accretion rate assumes that both colliding particles are spherical. It does not take into account the reduced cross-section of snow particles that is used when modeling snow - cloud liquid water and snow - cloud ice accretion.</li><li>In the definition of the Reynolds number that is used when computing ventilation factors.</li></ul><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">definition</th><th style="text-align: right">units</th><th style="text-align: right">default value</th><th style="text-align: right">reference</th></tr><tr><td style="text-align: right"><span>$r_0^{rai}$</span></td><td style="text-align: right">typical rain drop radius</td><td style="text-align: right"><span>$m$</span></td><td style="text-align: right"><span>$10^{-3}$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$m_0^{rai}$</span></td><td style="text-align: right">coefficient in <span>$m(r)$</span> for rain</td><td style="text-align: right"><span>$kg$</span></td><td style="text-align: right"><span>$\frac{4}{3} \, \pi \, \rho_{water} \, r_0^3$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$m_e^{rai}$</span></td><td style="text-align: right">exponent in <span>$m(r)$</span> for rain</td><td style="text-align: right">-</td><td style="text-align: right"><span>$3$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$a_0^{rai}$</span></td><td style="text-align: right">coefficient in <span>$a(r)$</span> for rain</td><td style="text-align: right"><span>$m^2$</span></td><td style="text-align: right"><span>$\pi \, r_0^2$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$a_e^{rai}$</span></td><td style="text-align: right">exponent in <span>$a(r)$</span> for rain</td><td style="text-align: right">-</td><td style="text-align: right"><span>$2$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$v_e^{rai}$</span></td><td style="text-align: right">exponent in <span>$v_{term}(r)$</span> for rain</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.5$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"></td><td style="text-align: right"></td><td style="text-align: right"></td><td style="text-align: right"></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$r_0^{ice}$</span></td><td style="text-align: right">typical ice crystal radius</td><td style="text-align: right"><span>$m$</span></td><td style="text-align: right"><span>$10^{-5}$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$m_0^{ice}$</span></td><td style="text-align: right">coefficient in <span>$m(r)$</span> for ice</td><td style="text-align: right"><span>$kg$</span></td><td style="text-align: right"><span>$\frac{4}{3} \, \pi \, \rho_{ice} \, r_0^3$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$m_e^{ice}$</span></td><td style="text-align: right">exponent in <span>$m(r)$</span> for ice</td><td style="text-align: right">-</td><td style="text-align: right"><span>$3$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"></td><td style="text-align: right"></td><td style="text-align: right"></td><td style="text-align: right"></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$r_0^{sno}$</span></td><td style="text-align: right">typical snow crystal radius</td><td style="text-align: right"><span>$m$</span></td><td style="text-align: right"><span>$10^{-3}$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$m_0^{sno}$</span></td><td style="text-align: right">coefficient in <span>$m(r)$</span> for snow</td><td style="text-align: right"><span>$kg$</span></td><td style="text-align: right"><span>$0.1 \,  r_0^2$</span></td><td style="text-align: right">eq (6b) <a href="../../../References/#Grabowski1998">Wojciech W Grabowski  (1998)</a></td></tr><tr><td style="text-align: right"><span>$m_e^{sno}$</span></td><td style="text-align: right">exponent in <span>$m(r)$</span> for snow</td><td style="text-align: right">-</td><td style="text-align: right"><span>$2$</span></td><td style="text-align: right">eq (6b) <a href="../../../References/#Grabowski1998">Wojciech W Grabowski  (1998)</a></td></tr><tr><td style="text-align: right"><span>$a_0^{sno}$</span></td><td style="text-align: right">coefficient in <span>$a(r)$</span> for snow</td><td style="text-align: right"><span>$m^2$</span></td><td style="text-align: right"><span>$0.3 \pi \, r_0^2$</span></td><td style="text-align: right"><span>$\alpha$</span> in eq(16b) <a href="../../../References/#Grabowski1998">Wojciech W Grabowski  (1998)</a>.</td></tr><tr><td style="text-align: right"><span>$a_e^{sno}$</span></td><td style="text-align: right">exponent in <span>$a(r)$</span> for snow</td><td style="text-align: right">-</td><td style="text-align: right"><span>$2$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$v_0^{sno}$</span></td><td style="text-align: right">coefficient in <span>$v_{term}(r)$</span> for snow</td><td style="text-align: right"><span>$\frac{m}{s}$</span></td><td style="text-align: right"><span>$2^{9/4} r_0^{1/4}$</span></td><td style="text-align: right">eq (6b) <a href="../../../References/#Grabowski1998">Wojciech W Grabowski  (1998)</a></td></tr><tr><td style="text-align: right"><span>$v_e^{sno}$</span></td><td style="text-align: right">exponent in <span>$v_{term}(r)$</span> for snow</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.25$</span></td><td style="text-align: right">eq (6b) <a href="../../../References/#Grabowski1998">Wojciech W Grabowski  (1998)</a></td></tr></table><p>where:</p><ul><li><span>$\rho_{water}$</span> is the density of water,</li><li><span>$\rho_{ice}$</span> is the density of ice.</li></ul><p>The terminal velocity of an individual rain drop is defined by the balance   between the gravitational acceleration (taking into account   the density difference between water and air) and the drag force. Therefore the <span>$v_0^{rai}$</span> is defined as</p><p class="math-container">\[\begin{equation}
v_0^{rai} =
  \left(
    \frac{8}{3 \, C_{drag}} \left( \frac{\rho_{water}}{\rho} -1 \right)
  \right)^{1/2} (g r_0^{rai})^{1/2}
\label{eq:vdrop}
\end{equation}\]</p><p>where:</p><ul><li><span>$g$</span> is the gravitational acceleration,</li><li><span>$C_{drag}$</span> is the drag coefficient,</li><li><span>$\rho$</span> is the density of air.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>It would be great to replace the above simple power laws with more accurate relationships. For example: <a href="../../../References/#Khvorostyanov2002">Vitaly I Khvorostyanov , Judith A Curry  (2002)</a> or <a href="../../../References/#Karrer2020">M Karrer , A Seifert , C Siewert , D Ori , A von Lerber , S Kneifel  (2020)</a></p></div></div><h2 id="Assumed-particle-size-distributions"><a class="docs-heading-anchor" href="#Assumed-particle-size-distributions">Assumed particle size distributions</a><a id="Assumed-particle-size-distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Assumed-particle-size-distributions" title="Permalink"></a></h2><p>The particle size distributions are assumed to follow   Marshall-Palmer distribution   <a href="../../../References/#Marshall1948">John S Marshall , W Mc K Palmer  (1948)</a>   eq. 1:</p><p class="math-container">\[\begin{equation}
  n(r) = n_{0} exp\left(- \lambda \, r \right)
\end{equation}\]</p><p>where:</p><ul><li><span>$n_{0}$</span> and <span>$\lambda$</span> are the Marshall-Palmer distribution parameters.</li></ul><p>The <span>$n_0$</span> for rain and ice is assumed constant. The <span>$n_0$</span> for snow is defined as</p><p class="math-container">\[\begin{equation}
  n_0^{sno} = \mu^{sno} \left(\frac{\rho}{\rho_0} q_{sno}\right)^{\nu^{sno}}
\end{equation}\]</p><p>where:</p><ul><li><span>$\mu^{sno}$</span> and <span>$\nu^{sno}$</span> are the coefficients</li><li><span>$\rho_0$</span> is the typical air density used to nondimensionalize the equation and is equal to <span>$1 \, kg/m^3$</span></li></ul><p>The coefficients are defined in   <a href="https://github.com/CliMA/CLIMAParameters.jl">CLIMAParameters.jl</a> package and are shown in the table below.</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">definition</th><th style="text-align: right">units</th><th style="text-align: right">default value</th><th style="text-align: right">reference</th></tr><tr><td style="text-align: right"><span>$n_{0}^{rai}$</span></td><td style="text-align: right">rain drop size distribution parameter</td><td style="text-align: right"><span>$\frac{1}{m^4}$</span></td><td style="text-align: right"><span>$16 \cdot 10^6$</span></td><td style="text-align: right">eq (2) <a href="../../../References/#Marshall1948">John S Marshall , W Mc K Palmer  (1948)</a></td></tr><tr><td style="text-align: right"><span>$n_{0}^{ice}$</span></td><td style="text-align: right">cloud ice size distribution parameter</td><td style="text-align: right"><span>$\frac{1}{m^4}$</span></td><td style="text-align: right"><span>$2 \cdot 10^7$</span></td><td style="text-align: right">bottom of page 4396 <a href="../../../References/#Kaul2015">Colleen M Kaul , Jo { \~a } o Teixeira , Kentaroh Suzuki  (2015)</a></td></tr><tr><td style="text-align: right"><span>$\mu^{sno}$</span></td><td style="text-align: right">snow size distribution parameter coefficient</td><td style="text-align: right"><span>$\frac{1}{m^4}$</span></td><td style="text-align: right"><span>$4.36 \cdot 10^9 \, \rho_0^{\nu^{sno}}$</span></td><td style="text-align: right">eq (A1) <a href="../../../References/#Kaul2015">Colleen M Kaul , Jo { \~a } o Teixeira , Kentaroh Suzuki  (2015)</a></td></tr><tr><td style="text-align: right"><span>$\nu^{sno}$</span></td><td style="text-align: right">snow size distribution parameter exponent</td><td style="text-align: right"><span>$-$</span></td><td style="text-align: right"><span>$0.63$</span></td><td style="text-align: right">eq (A1) <a href="../../../References/#Kaul2015">Colleen M Kaul , Jo { \~a } o Teixeira , Kentaroh Suzuki  (2015)</a></td></tr></table><p>The <span>$\lambda$</span> parameter is defined as</p><p class="math-container">\[\begin{equation}
\lambda =
  \left(
    \frac{ \Gamma(m_e + \Delta_m + 1) \, \chi_m \, m_0 \, n_0}
         {q \, \rho \, (r_0)^{m_e + \Delta_m}}
  \right)^{\frac{1}{m_e + \Delta_m + 1}}
\end{equation}\]</p><p>where:</p><ul><li><span>$q$</span> is rain, snow or ice specific humidity</li><li><span>$\chi_m$</span>, <span>$m_0$</span>, <span>$m_e$</span>, <span>$\Delta_m$</span>, <span>$r_0$</span>, and <span>$n_0$</span> are the corresponding mass(radius) and size distribution parameters</li><li><span>$\Gamma()$</span> is the gamma function</li></ul><p>The cloud-ice size distribution is used   when computing snow autoconversion rate and rain sink due to accretion. In other derivations cloud ice, similar to cloud liquid water,   is treated as continuous.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><ul><li><p>Do we want to keep the <span>$n_0$</span> for rain constant and <span>$n_0$</span> for snow empirical?</p></li><li><p>Do we want to test different size distributions?</p></li></ul></div></div><h2 id="Parameterized-processes"><a class="docs-heading-anchor" href="#Parameterized-processes">Parameterized processes</a><a id="Parameterized-processes-1"></a><a class="docs-heading-anchor-permalink" href="#Parameterized-processes" title="Permalink"></a></h2><p>Parameterized processes include:</p><ul><li>diffusion of water vapour on cloud droplets and cloud ice crystals modeled as a relaxation to equilibrium,</li><li>autoconversion of rain and snow,</li><li>accretion,</li><li>evaporation of rain water,</li><li>sublimation, vapor deposition and melting of snow,</li><li>sedimentation of rain and snow with mass weighted average terminal velocity (cloud water and cloud ice are part of the working fluid and do not sediment).</li></ul><p>Parameters used in the parameterization are defined in   <a href="https://github.com/CliMA/CLIMAParameters.jl">CLIMAParameters.jl</a> package. They consist of:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">definition</th><th style="text-align: right">units</th><th style="text-align: right">default value</th><th style="text-align: right">reference</th></tr><tr><td style="text-align: right"><span>$C_{drag}$</span></td><td style="text-align: right">rain drop drag coefficient</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.55$</span></td><td style="text-align: right"><span>$C_{drag}$</span> is such that the mass averaged terminal velocity is close to <a href="../../../References/#Grabowski1996">Wojciech W Grabowski , Piotr K Smolarkiewicz  (1996)</a></td></tr><tr><td style="text-align: right"><span>$\tau_{cond\_evap}$</span></td><td style="text-align: right">cloud water condensation/evaporation timescale</td><td style="text-align: right"><span>$s$</span></td><td style="text-align: right"><span>$10$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$\tau_{dep\_sub}$</span></td><td style="text-align: right">cloud ice deposition/sublimation timescale</td><td style="text-align: right"><span>$s$</span></td><td style="text-align: right"><span>$10$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$\tau_{acnv}$</span></td><td style="text-align: right">cloud to rain water autoconversion timescale</td><td style="text-align: right"><span>$s$</span></td><td style="text-align: right"><span>$10^3$</span></td><td style="text-align: right">eq (5a) <a href="../../../References/#Grabowski1996">Wojciech W Grabowski , Piotr K Smolarkiewicz  (1996)</a></td></tr><tr><td style="text-align: right"><span>$q_{liq\_threshold}$</span></td><td style="text-align: right">cloud to rain water autoconversion threshold</td><td style="text-align: right">-</td><td style="text-align: right"><span>$5 \cdot 10^{-4}$</span></td><td style="text-align: right">eq (5a) <a href="../../../References/#Grabowski1996">Wojciech W Grabowski , Piotr K Smolarkiewicz  (1996)</a></td></tr><tr><td style="text-align: right"><span>$r_{is}$</span></td><td style="text-align: right">threshold particle radius between ice and snow</td><td style="text-align: right"><span>$m$</span></td><td style="text-align: right"><span>$62.5 \cdot 10^{-6}$</span></td><td style="text-align: right">abstract <a href="../../../References/#Harrington1995">Jerry Y Harrington , Michael P Meyers , Robert L Walko , William R Cotton  (1995)</a></td></tr><tr><td style="text-align: right"><span>$E_{lr}$</span></td><td style="text-align: right">collision efficiency between rain drops and cloud droplets</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.8$</span></td><td style="text-align: right">eq (16a) <a href="../../../References/#Grabowski1998">Wojciech W Grabowski  (1998)</a></td></tr><tr><td style="text-align: right"><span>$E_{ls}$</span></td><td style="text-align: right">collision efficiency between snow and cloud droplets</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.1$</span></td><td style="text-align: right">Appendix B <a href="../../../References/#Rutledge1983">Steven A Rutledge , Peterv Hobbs  (1983)</a></td></tr><tr><td style="text-align: right"><span>$E_{ir}$</span></td><td style="text-align: right">collision efficiency between rain drops and cloud ice</td><td style="text-align: right">-</td><td style="text-align: right"><span>$1$</span></td><td style="text-align: right">Appendix B <a href="../../../References/#Rutledge1984">Steven A Rutledge , Peter V Hobbs  (1984)</a></td></tr><tr><td style="text-align: right"><span>$E_{is}$</span></td><td style="text-align: right">collision efficiency between snow and cloud ice</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.1$</span></td><td style="text-align: right">bottom page 3649 <a href="../../../References/#Morrison2008">Hugh Morrison , Andrew Gettelman  (2008)</a></td></tr><tr><td style="text-align: right"><span>$E_{rs}$</span></td><td style="text-align: right">collision efficiency between rain drops and snow</td><td style="text-align: right">-</td><td style="text-align: right"><span>$1$</span></td><td style="text-align: right">top page 3650 <a href="../../../References/#Morrison2008">Hugh Morrison , Andrew Gettelman  (2008)</a></td></tr><tr><td style="text-align: right"><span>$a_{vent}^{rai}, b_{vent}^{rai}$</span></td><td style="text-align: right">rain drop ventilation factor coefficients</td><td style="text-align: right">-</td><td style="text-align: right"><span>$1.5 \;$</span>,<span>$\; 0.53$</span></td><td style="text-align: right">chosen such that at <span>$q_{tot}=15 g/kg$</span> and <span>$T=288K$</span> the evap. rate is close to empirical evap. rate in <a href="../../../References/#Grabowski1996">Wojciech W Grabowski , Piotr K Smolarkiewicz  (1996)</a></td></tr><tr><td style="text-align: right"><span>$a_{vent}^{sno}, b_{vent}^{sno}$</span></td><td style="text-align: right">snow ventilation factor coefficients</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.65 \;$</span>,<span>$\; 0.44$</span></td><td style="text-align: right">eq (A19) <a href="../../../References/#Kaul2015">Colleen M Kaul , Jo { \~a } o Teixeira , Kentaroh Suzuki  (2015)</a></td></tr><tr><td style="text-align: right"><span>$K_{therm}$</span></td><td style="text-align: right">thermal conductivity of air</td><td style="text-align: right"><span>$\frac{J}{m \; s \; K}$</span></td><td style="text-align: right"><span>$2.4 \cdot 10^{-2}$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$\nu_{air}$</span></td><td style="text-align: right">kinematic viscosity of air</td><td style="text-align: right"><span>$\frac{m^2}{s}$</span></td><td style="text-align: right"><span>$1.6 \cdot 10^{-5}$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$D_{vapor}$</span></td><td style="text-align: right">diffusivity of water vapor</td><td style="text-align: right"><span>$\frac{m^2}{s}$</span></td><td style="text-align: right"><span>$2.26 \cdot 10^{-5}$</span></td><td style="text-align: right"></td></tr></table><h2 id="Ventilation-factor"><a class="docs-heading-anchor" href="#Ventilation-factor">Ventilation factor</a><a id="Ventilation-factor-1"></a><a class="docs-heading-anchor-permalink" href="#Ventilation-factor" title="Permalink"></a></h2><p>The ventilation factor parameterizes the increase in the mass and heat exchange   for falling particles. Following <a href="../../../References/#Seifert2006">Axel Seifert , Klaus Dieter Beheng  (2006)</a>   eq. 24  the ventilation factor is defined as:</p><p class="math-container">\[\begin{equation}
  F(r) = a_{vent} + b_{vent}  N_{Sc}^{1/3} N_{Re}(r)^{1/2}
\label{eq:ventil_factor}
\end{equation}\]</p><p>where:</p><ul><li><span>$a_{vent}$</span>, <span>$b_{vent}$</span> are coefficients,</li><li><span>$N_{Sc}$</span> is the Schmidt number,</li><li><span>$N_{Re}$</span> is the Reynolds number of a falling particle.</li></ul><p>The Schmidt number is assumed constant:</p><p class="math-container">\[N_{Sc} = \frac{\nu_{air}}{D_{vapor}}\]</p><p>where:</p><ul><li><span>$\nu_{air}$</span> is the kinematic viscosity of air,</li><li><span>$D_{vapor}$</span> is the diffusivity of water.</li></ul><p>The Reynolds number of a spherical drop is defined as:</p><p class="math-container">\[N_{Re} = \frac{2 \, r \, v_{term}(r)}{\nu_{air}}\]</p><p>Applying the terminal velocity(radius) relationship results in</p><p class="math-container">\[\begin{equation}
F(r) = a_{vent} +
       b_{vent} \,
       \left(\frac{\nu_{air}}{D_{vapor}}\right)^{\frac{1}{3}} \,
       \left(\frac{2 \, \chi_v \, v_0}
                  {r_0^{v_e + \Delta_v} \, \nu_{air}}\right)^{\frac{1}{2}} \,
       r^{\frac{v_e + \Delta_v + 1}{2}}
\label{eq:vent_factor}
\end{equation}\]</p><h2 id="Terminal-velocity"><a class="docs-heading-anchor" href="#Terminal-velocity">Terminal velocity</a><a id="Terminal-velocity-1"></a><a class="docs-heading-anchor-permalink" href="#Terminal-velocity" title="Permalink"></a></h2><p>The mass weighted terminal velocity <span>$v_t$</span> is defined following <a href="../../../References/#Ogura1971">Yoshimitsu Ogura , Tsutomu Takahashi  (1971)</a>:</p><p class="math-container">\[\begin{equation}
  v_t = \frac{\int_0^\infty n(r) \, m(r) \, v_{term}(r) \, dr}
             {\int_0^\infty n(r) \, m(r) \, dr}
\label{eq:vt}
\end{equation}\]</p><p>Integrating over the assumed Marshall-Palmer distribution and using the   <span>$m(r)$</span> and <span>$v_{term}(r)$</span> relationships results in</p><p class="math-container">\[\begin{equation}
  v_t = \chi_v \, v_0 \, \left(\frac{1}{r_0 \, \lambda}\right)^{v_e + \Delta_v}
        \frac{\Gamma(m_e + v_e + \Delta_m + \Delta_v + 1)}
             {\Gamma(m_e + \Delta_m + 1)}
\end{equation}\]</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Assuming a constant drag coefficient is an approximation and it should be size and flow dependent. &lt;!– <a href="https://www.grc.nasa.gov/www/K-12/airplane/dragsphere.html">drag_coefficient</a> –&gt; In general we should implement these terminal velocity parameterizations: <a href="../../../References/#Khvorostyanov2002">Vitaly I Khvorostyanov , Judith A Curry  (2002)</a> or <a href="../../../References/#Karrer2020">M Karrer , A Seifert , C Siewert , D Ori , A von Lerber , S Kneifel  (2020)</a></p></div></div><h2 id="Cloud-water-condensation/evaporation"><a class="docs-heading-anchor" href="#Cloud-water-condensation/evaporation">Cloud water condensation/evaporation</a><a id="Cloud-water-condensation/evaporation-1"></a><a class="docs-heading-anchor-permalink" href="#Cloud-water-condensation/evaporation" title="Permalink"></a></h2><p>Condensation and evaporation of cloud liquid water is parameterized   as a relaxation to equilibrium value at the current time step.</p><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{liq}}{dt} \right|_{cond, evap} =
    \frac{q^{eq}_{liq} - q_{liq}}{\tau_{cond\_evap}}
\end{equation}\]</p><p>where:</p><ul><li><span>$q^{eq}_{liq}$</span> - liquid water specific humidity in equilibrium,</li><li><span>$q_{liq}$</span> - liquid water specific humidity,</li><li><span>$\tau_{cond\_evap}$</span> - relaxation timescale.</li></ul><h2 id="Cloud-ice-deposition/sublimation"><a class="docs-heading-anchor" href="#Cloud-ice-deposition/sublimation">Cloud ice deposition/sublimation</a><a id="Cloud-ice-deposition/sublimation-1"></a><a class="docs-heading-anchor-permalink" href="#Cloud-ice-deposition/sublimation" title="Permalink"></a></h2><p>Deposition and sublimation of cloud ice is parameterized as   a relaxation to equilibrium value at the current time step.</p><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{ice}}{dt} \right|_{dep, sub} =
    \frac{q^{eq}_{ice} - q_{ice}}{\tau_{dep\_sub}}
\end{equation}\]</p><p>where:</p><ul><li><span>$q^{eq}_{ice}$</span> - ice specific humidity in equilibrium,</li><li><span>$q_{ice}$</span> - ice specific humidity,</li><li><span>$\tau_{dep\_sub}$</span> - relaxation timescale.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Both <span>$\tau_{cond\_evap}$</span> and <span>$\tau_{dep\_sub}$</span> are assumed constant here. It would be great to make the relaxation time a function of available condensation nuclei, turbulence intensity, etc. See works by <a href="https://www.mtu.edu/physics/department/faculty/shaw/">prof Raymond Shaw</a> for hints. In particular, <a href="../../../References/#Desai2019">Neel Desai , KK Chandrakar , G Kinney , W Cantrell , RA Shaw  (2019)</a>.</p></div></div><h2 id="Rain-autoconversion"><a class="docs-heading-anchor" href="#Rain-autoconversion">Rain autoconversion</a><a id="Rain-autoconversion-1"></a><a class="docs-heading-anchor-permalink" href="#Rain-autoconversion" title="Permalink"></a></h2><p>Rain autoconversion defines the rate of conversion form cloud liquid water   to rain water due to collisions between cloud droplets. It is parameterized following   <a href="../../../References/#Kessler1995">Edwin Kessler  (1995)</a>:</p><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{acnv} =
    \frac{max(0, q_{liq} - q_{liq\_threshold})}{\tau_{acnv}}
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{liq}$</span> - liquid water specific humidity,</li><li><span>$\tau_{acnv}$</span> - timescale,</li><li><span>$q_{liq\_threshold}$</span> - autoconversion threshold.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This is the simplest possible autoconversion parameterization. It would be great to implement others and test the impact on precipitation. See for example <a href="../../../References/#Wood2005">R Wood  (2005)</a> Table 1 for other simple choices.</p></div></div><h2 id="Snow-autoconversion"><a class="docs-heading-anchor" href="#Snow-autoconversion">Snow autoconversion</a><a id="Snow-autoconversion-1"></a><a class="docs-heading-anchor-permalink" href="#Snow-autoconversion" title="Permalink"></a></h2><p>Snow autoconversion defines the rate of conversion form cloud ice to snow due   the growth of cloud ice by water vapor deposition. It is defined as the change of mass of cloud ice for cloud ice particles   larger than threshold <span>$r_{is}$</span>. See <a href="../../../References/#Harrington1995">Jerry Y Harrington , Michael P Meyers , Robert L Walko , William R Cotton  (1995)</a>   for derivation.</p><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{sno}}{dt} \right|_{acnv} =
  \frac{1}{\rho} \frac{d}{dt}
    \left( \int_{r_{is}}^{\infty} m(r) n(r) dr \right) =
    \left. \frac{1}{\rho} \frac{dr}{dt} \right|_{r=r_{is}} m(r_{is}) n(r_{is})
    + \frac{1}{\rho} \int_{r_{is}}^{\infty} \frac{dm}{dt} n(r) dr
\end{equation}\]</p><p>The <span>$\frac{dm}{dt}$</span> is obtained by solving the water vapor diffusion equation   in spherical coordinates and linking the changes in temperature at the drop   surface to the changes in saturated vapor pressure via the Clausius-Clapeyron   equation, following   <a href="../../../References/#Mason2010">Basil John Mason  (2010)</a>.</p><p>For the simplest case of spherical particles and not taking into account   ventilation effects:</p><p class="math-container">\[\begin{equation}
\frac{dm}{dt} = 4 \pi \, r \, (S - 1) \, G(T)
\label{eq:mass_rate}
\end{equation}\]</p><p>where:</p><ul><li><span>$S(q_{vap}, q_{vap}^{sat}) = \frac{q_{vap}}{q_{vap}^{sat}}$</span> is saturation,</li><li><span>$q_{vap}^{sat}$</span>   is the saturation vapor specific humidity (over ice in this case),</li><li><span>$G(T) = \left(\frac{L_s}{KT} \left(\frac{L_s}{R_v T} - 1 \right) + \frac{R_v T}{p_{vap}^{sat} D} \right)^{-1}$</span>   combines the effects of thermal conductivity and water diffusivity.</li><li><span>$L_s$</span> is the latent heat of sublimation,</li><li><span>$K_{thermo}$</span> is the thermal conductivity of air,</li><li><span>$R_v$</span> is the gas constant of water vapor,</li><li><span>$D_{vapor}$</span> is the diffusivity of water vapor</li></ul><p>Using eq. (\ref{eq:mass_rate}) and the assumed <span>$m(r)$</span> relationship we obtain</p><p class="math-container">\[\begin{equation}
\frac{dr}{dt} = \frac{4 \pi \, (S - 1)}{\chi_m \, (m_e + \Delta_m)}
  \, \left( \frac{r_0}{r} \right)^{m_e + \Delta_m}
  \, \frac{G(T) \, r^2}{m_0}
\label{eq:r_rate}
\end{equation}\]</p><p>Finally the snow autoconversion rate is computed as</p><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{sno}}{dt} \right|_{acnv} =
   \frac{1}{\rho} 4 \pi \, (S-1) \, G(T) \,
   n_0^{ice} \, exp(-\lambda_{ice} r_{is})
   \left( \frac{r_{is}^2}{m_e^{ice} + \Delta_m^{ice}} +
   \frac{r_{is} \lambda_{ice} +1}{\lambda_{ice}^2} \right)
\end{equation}\]</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We should include ventilation effects.</p><p>For non-spherical particles the mass rate of growth should be multiplied by a function depending on the particle aspect ratio. For functions proposed for different crystal habitats see <a href="../../../References/#Harrington1995">Jerry Y Harrington , Michael P Meyers , Robert L Walko , William R Cotton  (1995)</a> Appendix B.</p></div></div><h2 id="Accretion"><a class="docs-heading-anchor" href="#Accretion">Accretion</a><a id="Accretion-1"></a><a class="docs-heading-anchor-permalink" href="#Accretion" title="Permalink"></a></h2><p>Accretion defines the rates of conversion between different categories due to   collisions between particles.</p><p>For the case of collisions between cloud water (liquid water or ice)   and precipitation (rain or snow) the sink of cloud water is defined as:</p><p class="math-container">\[\begin{equation}
\left. \frac{d \, q_{c}}{dt} \right|_{accr} =
  - \int_0^\infty n_p(r) \, a^p(r) \, v_{term}(r) \, E_{cp} \, q_{c} \, dr
\label{eq:accr_1}
\end{equation}\]</p><p>where:</p><ul><li><span>$c$</span> subscript indicates cloud water category (cloud liquid water or ice)</li><li><span>$p$</span> subscript indicates precipitation category (rain or snow)</li><li><span>$E_{cp}$</span> is the collision efficiency.</li></ul><p>Integrating over the distribution yields:</p><p class="math-container">\[\begin{equation}
\left. \frac{d \, q_c}{dt} \right|_{accr} =
  - n_{0}^p \, \Pi_{a, v}^p \, q_c \, E_{cp} \,
    \Gamma(\Sigma_{a, v}^p + 1) \,
    \frac{1}{\lambda^p} \,
    \left( \frac{1}{r_0^p \lambda^p}
    \right)^{\Sigma_{a, v}^p}
\label{eq:accrfin}
\end{equation}\]</p><p>where:</p><ul><li><span>$\Pi_{a, v}^p = a_0^p \, v_0^p \, \chi_a^p \, \chi_v^p$</span></li><li><span>$\Sigma_{a, v}^p = a_e^p + v_e^p + \Delta_a^p + \Delta_v^p$</span></li></ul><p>For the case of cloud liquid water and rain and cloud ice and snow collisions,   the sink of cloud water becomes simply the source for precipitation. For the case of cloud liquid water and snow collisions   for temperatures below freezing, the sink of cloud liquid water is   a source for snow. For temperatures above freezing, the accreted cloud droplets   along with some melted snow are converted to rain. In this case eq. (\ref{eq:accrfin}) describes the sink of cloud liquid water. The sink of snow is proportional to the sink of cloud liquid water with   the coefficient <span>$\frac{c_{vl}}{L_f}(T - T_{freeze})$</span>,   where <span>$c_{vl}$</span> is the isochoric specific heat of liquid water,  <span>$L_f$</span> is the latent heat of freezing,   and <span>$T_{freeze}$</span> is the freezing temperature.</p><p>The collisions between cloud ice and rain create snow. The source of snow in this case is a sum of sinks from cloud ice and rain. The sink of cloud ice is defined by eq. (\ref{eq:accrfin}). The sink of rain is defined as:</p><p class="math-container">\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{accr\_ri} =
  - \int_0^\infty \int_0^\infty
  \frac{1}{\rho} \, E_{ir} \, n_i(r_i) \, n_r(r_r) \, a_r(r_r) \, m_r(r_r)
  \, v_{term}(r_r) \, d r_i d r_r
\label{eq:accr_ir}
\end{equation}\]</p><p>where:</p><ul><li><span>$E_{ir}$</span> is the collision efficiency between rain and cloud ice</li><li><span>$n_i$</span> and <span>$n_r$</span> are the cloud ice and rain size distributions</li><li><span>$m_r$</span>, <span>$a_r$</span> and <span>$v_{term}$</span> are the mass(radius),   cross section(radius) and terminal velocity(radius) relations for rain</li><li><span>$r_i$</span> and <span>$r_r$</span> mark integration over cloud ice and rain size   distributions</li></ul><p>Integrating eq.(\ref{eq:accr_ir}) yields:</p><p class="math-container">\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{accr\_ri} =
  - \frac{1}{\rho} \, E_{ir} \, n_0^{rai} \, n_0^{ice} \,
  \Pi_{m, a, v}^{rai}
  \Gamma(\Sigma_{m, a, v}^{rai} + 1) \,
  \frac{1}{\lambda^{ice} \, \lambda^{rai}} \,
  \left( \frac{1}{r_0^{rai} \, \lambda^{rai}}
  \right)^{\Sigma_{m, a, v}^{rai}}
\end{equation}\]</p><p>where:</p><ul><li><span>$\Pi_{m, a, v}^{rai} =  m_0^{rai} \, a_0^{rai} \, v_0^{rai} \, \chi_m^{rai} \, \chi_a^{rai} \, \chi_v^{rai}$</span></li><li><span>$\Sigma_{m, a, v}^{rai} = m_e^{rai} + a_e^{rai} + v_e^{rai} + \Delta_m^{rai} + \Delta_a^{rai} + \Delta_v^{rai}$</span></li></ul><p>Collisions between rain and snow result in snow in temperatures below freezing   and in rain in temperatures above freezing. The source term is defined as:</p><p class="math-container">\[\begin{equation}
\left. \frac{d \, q_i}{dt} \right|_{accr} =
    \int_0^\infty \int_0^\infty \frac{1}{\rho}
    n_i(r_i) \, n_j(r_j) \, a(r_i, r_j) \, m_j(r_j) \, E_{ij} \,
    \left|v_{term}(r_i) - v_{term}(r_j)\right| \, dr_i dr_j
\label{eq:accr_sr1}
\end{equation}\]</p><p>where</p><ul><li><span>$i$</span> stands for rain (<span>$T&gt;T_{freezing}$</span>) or snow (<span>$T&lt;T_{freezing}$</span>)</li><li><span>$j$</span> stands for snow (<span>$T&gt;T_{freezing}$</span>) or rain (<span>$T&lt;T_{freezing}$</span>)</li><li><span>$a(r_i, r_j)$</span> is the crossection of the two colliding particles</li></ul><p>There are two additional assumptions that we make to integrate   eq.(\ref{eq:accr_sr1}):</p><ul><li><p><span>$\left|v_{term}(r_i) - v_{term}(r_j)\right| \approx \left| v_{ti} - v_{tj} \right|$</span> We approximate the terminal velocity difference for each particle pair with a difference between mass-weighted mean terminal velocities and move it outside of the integral. See the discussion in <a href="https://www.mri-jma.go.jp/Publish/Technical/DATA/VOL_28/28_005.pdf">Ikawa_and_Saito_1991</a> page 88.</p></li><li><p>We assume that <span>$a(r_i, r_j) = \pi (r_i + r_j)^2$</span>. This corresponds to a geometric formulation of the collision kernel, aka cylindrical formulation, see <a href="../../../References/#Wang2006">Lian-Ping Wang , Charmaine N Franklin , Orlando Ayala , Wojciech W Grabowski  (2006)</a> for discussion.</p></li></ul><p>The eq.(\ref{eq:accr_sr1}) can then be integrated as:</p><p class="math-container">\[\begin{align}
\left. \frac{d \, q_i}{dt} \right|_{accr} &amp; =
    \frac{1}{\rho} \, \pi \, n_0^{i} \, n_0^{j} \,
    m_0^j \, \chi_m^j \, \left(\frac{1}{r_0^j}\right)^{m_e^j + \Delta_m^j}
    \, E_{ij} \left| v_{ti} - v_{tj} \right|
    \int_0^\infty \int_0^\infty
    (r_i + r_j)^2
    r_{j}^{m_e^j + \Delta_m^j} \,
    exp(- \lambda_j r_j) \,
    exp(- \lambda_i r_i) \,
    dr_i dr_j \\
    &amp; =
    \frac{1}{\rho} \, \pi \, n_0^{i} \, n_0^{j} \, m_0^j \, \chi_m^j \,
    E_{ij} \left| v_{ti} - v_{tj} \right| \,
    \left( \frac{1}{r_0^j} \right)^{m_e^j + \Delta_m^j}
    \left(
        \frac{2 \Gamma(m_e^j + \Delta_m^j + 1)}{\lambda_i^3 \lambda_j^{m_e^j + \Delta_m^j + 1}}
        + \frac{2 \Gamma(m_e^j + \Delta_m^j + 2)}{ \lambda_i^2 \lambda_j^{m_e^j + \Delta_m^j + 2}}
        + \frac{\Gamma(m_e^j + \Delta_m^j + 3)}{\lambda_i \lambda_j^{m_e^j + \Delta_m^j + 3}}
    \right)
\end{align}\]</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Both of the assumptions needed to integrate the snow-rain accretion rate could be revisited:</p><p>The discussion on page 88 in <a href="https://www.mri-jma.go.jp/Publish/Technical/DATA/VOL_28/28_005.pdf">Ikawa_and_Saito_1991</a> suggests an alternative approximation of the velocity difference.</p><p>The <span>$(r_i + r_j)^2$</span> assumption for the crossection is inconsistent with the snow crossection used when modelling collisions with cloud water and cloud ice.</p></div></div><h2 id="Rain-evaporation-and-snow-sublimation"><a class="docs-heading-anchor" href="#Rain-evaporation-and-snow-sublimation">Rain evaporation and snow sublimation</a><a id="Rain-evaporation-and-snow-sublimation-1"></a><a class="docs-heading-anchor-permalink" href="#Rain-evaporation-and-snow-sublimation" title="Permalink"></a></h2><p>We start from a similar equation as when computing snow autoconversion rate but integrate it from <span>$0$</span> to <span>$\infty$</span>.</p><p class="math-container">\[\begin{equation}
  \left. \frac{dq}{dt} \right|_{evap\_subl} =
    \frac{1}{\rho} \int_{0}^{\infty} \frac{dm(r)}{dt} n(r) dr
\end{equation}\]</p><p>In contrast to eq.(\ref{eq:mass_rate}), now we are taking into account   ventilation effects:</p><p class="math-container">\[\begin{equation}
  \frac{dm}{dt} = 4 \pi \, r \, (S - 1) \, G(T) \, F(r)
\label{eq:mass_rate2}
\end{equation}\]</p><p>where:</p><ul><li><span>$F(r)$</span> is the rain drop ventilation factor defined in (\ref{eq:ventil_factor})</li><li>saturation S is computed over water or ice</li></ul><p>The final integral is:</p><p class="math-container">\[\begin{align}
\left. \frac{dq}{dt} \right|_{evap\_subl} &amp; =
    \frac{4 \pi n_0}{\rho} (S - 1) G(T)
    \int_0^\infty
    \left(
       a_{vent} +
       b_{vent} \,
         \left(\frac{\nu_{air}}{D_{vapor}} \right)^{\frac{1}{3}} \,
         \left(\frac{r}{r_0} \right)^{\frac{v_e + \Delta_v}{2}} \,
         \left(\frac{2 \, \chi_v \, v_0 \, r}{\nu_{air}} \right)^{\frac{1}{2}}
    \right)
    r \, exp(-\lambda r) dr \\
    &amp; =
    \frac{4 \pi n_0}{\rho} (S - 1) G(T) \lambda^{-2}
    \left(
       a_{vent} +
       b_{vent} \,
         \left(\frac{\nu_{air}}{D_{vapor}} \right)^{\frac{1}{3}} \,
         \left(\frac{1}{r_0 \, \lambda} \right)^{\frac{v_e + \Delta_v}{2}} \,
         \left(\frac{2 \, \chi_v \, v_0}{\nu_{air} \, \lambda} \right)^{\frac{1}{2}} \,
         \Gamma\left( \frac{v_e + \Delta_v + 5}{2} \right)
    \right)
\end{align}\]</p><p>For the case of rain we only consider evaporation (<span>$S - 1 &lt; 0$</span>). For the case of snow we consider both the source term due to vapor deposition  on snow (<span>$S - 1 &gt; 0$</span>) and the sink due to vapor sublimation (<span>$S - 1 &lt; 0$</span>).</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We should take into account the non-spherical snow shape. Modify the Reynolds number and growth equation.</p></div></div><h2 id="Snow-melt"><a class="docs-heading-anchor" href="#Snow-melt">Snow melt</a><a id="Snow-melt-1"></a><a class="docs-heading-anchor-permalink" href="#Snow-melt" title="Permalink"></a></h2><p>If snow occurs in temperatures above freezing it is melting into rain. The sink for snow is parameterized again as</p><p class="math-container">\[\begin{equation}
  \left. \frac{dq}{dt} \right|_{melt} =
    \frac{1}{\rho} \int_{0}^{\infty} \frac{dm(r)}{dt} n(r) dr
\end{equation}\]</p><p>For snow melt</p><p class="math-container">\[\begin{equation}
  \frac{dm}{dt} = 4 \pi \, r \, \frac{K_{thermo}}{L_f} (T - T_{freeze}) \, F(r)
\label{eq:mass_rate3}
\end{equation}\]</p><p>where:</p><ul><li><span>$F(r)$</span> is the ventilation factor defined in (\ref{eq:ventil_factor})</li><li><span>$L_f$</span> is the latent heat of freezing.</li></ul><p>If <span>$T &gt; T_{freeze}$</span>:</p><p class="math-container">\[\begin{equation}
\left. \frac{dq}{dt} \right|_{evap\_subl} =
    \frac{4 \pi \, n_0 \, K_{thermo}}{\rho \, L_f} (T - T_{freeze}) \lambda^{-2}
    \left(
       a_{vent} +
       b_{vent} \,
         \left( \frac{\nu_{air}}{D_{vapor}} \right)^{\frac{1}{3}} \,
         \left( \frac{1}{r_0 \, \lambda} \right)^{\frac{v_e + \Delta_v}{2}} \,
         \left( \frac{2 \, \chi_v \, v_0}{\nu_{air} \, \lambda} \right)^{\frac{1}{2}} \,
         \Gamma \left( \frac{v_e + \Delta_v + 5}{2} \right)
    \right)
\end{equation}\]</p><h2 id="Coupling-to-the-state-variables"><a class="docs-heading-anchor" href="#Coupling-to-the-state-variables">Coupling to the state variables</a><a id="Coupling-to-the-state-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Coupling-to-the-state-variables" title="Permalink"></a></h2><h3 id="Warm-Rain"><a class="docs-heading-anchor" href="#Warm-Rain">Warm Rain</a><a id="Warm-Rain-1"></a><a class="docs-heading-anchor-permalink" href="#Warm-Rain" title="Permalink"></a></h3><p>The source of rain <span>$\mathcal{S}_{q_{rai}}$</span> is a sum of the   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Rain-autoconversion">autoconversion</a>,   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Accretion">accretion</a>, and   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Rain-evaporation-and-snow-sublimation">rain evaporation</a>   processes. The sink of total water is equal to the source of rain:   <span>$\mathcal{S}_{q_{tot}}$</span> = -<span>$\mathcal{S}_{q_{rai}}$</span>. The sink of cloud liquid water is the sum of rain autoconversion   and rain accretion processes. Following the conservation equations for <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/AtmosModel/#Mass">mass</a>, <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/AtmosModel/#Moisture">moisture</a>, and <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/AtmosModel/#Precipitating-Species">precipitation</a> the <span>$\mathcal{S}_{q_{tot}}$</span> sink has to be multiplied by <span>$\rho$</span> before   adding it as one of the sink terms to both <span>$\rho$</span> and <span>$\rho q_{tot}$</span>   state variables. The <span>$\mathcal{S}_{q_{liq}}$</span>, <span>$\mathcal{S}_{q_{rai}}$</span> sources have to be multiplied by <span>$\rho$</span>   before adding them as one of the source terms to <span>$\rho q_{liq}$</span> and   <span>$\rho q_{rai}$</span>state variables. For the conservation equation for <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/AtmosModel/#Energy">total energy</a>,   the sink due to removing <span>$q_{tot}$</span> is computed as:</p><p class="math-container">\[\begin{equation}
\left. \mathcal{S}_{\rho e} \right|_{precip} =
  \left. \sum_{j\in\{v,l,i\}}(I_j + \Phi)  \rho C(q_j \rightarrow q_p) \right|_{precip} =
  (I_l + \Phi) \rho \, \mathcal{S}_{q_{tot}}
\end{equation}\]</p><p>where:</p><ul><li><span>$I_l = c_{vl} (T - T_0)$</span> is the internal energy of liquid water,</li><li><span>$T$</span> is the temperature,</li><li><span>$T_0$</span> is the thermodynamic reference temperature (which is unrelated to the reference temperature used in hydrostatic reference states used in the momentum equations),</li><li><span>$c_{vl}$</span> is the isochoric specific heat of liquid water,</li><li><span>$\Phi$</span> is the effective gravitational potential.</li></ul><h3 id="Rain-and-Snow"><a class="docs-heading-anchor" href="#Rain-and-Snow">Rain and Snow</a><a id="Rain-and-Snow-1"></a><a class="docs-heading-anchor-permalink" href="#Rain-and-Snow" title="Permalink"></a></h3><p>The source of rain <span>$\mathcal{S}_{q_{rai}}$</span> is a sum of the   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Rain-autoconversion">autoconversion</a>,   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Accretion">accretion</a>,   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Rain-evaporation-and-snow-sublimation">rain evaporation</a>, and   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Snow-melt">snow melt</a>   processes. Similarily, the source of snow <span>$\mathcal{S}_{q_{sno}}$</span> is a sum of the   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Snow-autoconversion">autoconversion</a>,   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Accretion">accretion</a>,   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Rain-evaporation-and-snow-sublimation">snow deposition/sublimation</a>, and   <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/Microphysics/#Snow-melt">snow melt</a>   processes. The sink of total water is equal to the sum of the rain and snow sources:   <span>$\mathcal{S}_{q_{tot}}$</span> = -<span>$\mathcal{S}_{q_{rai}}$</span> - <span>$\mathcal{S}_{q_{sno}}$</span>. The sink of cloud liquid water <span>$\mathcal{S}_{q_{liq}}$</span> is the sum of   rain autoconversion,   rain accretion with cloud liquid water, and   snow accretion with cloud liquid water processes. The sink of cloud ice <span>$\mathcal{S}_{q_{ice}}$</span> is the sum of   snow autoconversion,   snow accretion with cloud ice, and   rain accretion with cloud ice processes. Following the conservation equations for <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/AtmosModel/#Mass">mass</a>, <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/AtmosModel/#Moisture">moisture</a>, and <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/AtmosModel/#Precipitating-Species">precipitation</a> the <span>$\mathcal{S}_{q_{tot}}$</span> sink has to be multiplied by <span>$\rho$</span> before   adding it as one of the sink terms to both <span>$\rho$</span> and <span>$\rho q_{tot}$</span>   state variables. The <span>$\mathcal{S}_{q_{liq}}$</span>, <span>$\mathcal{S}_{q_{ice}}$</span>,   <span>$\mathcal{S}_{q_{rai}}$</span>, and <span>$\mathcal{S}_{q_{sno}}$</span> sources   have to be multiplied by <span>$\rho$</span> before adding them as one of the   source terms to <span>$\rho q_{liq}$</span>, <span>$\rho q_{ice}$</span>, <span>$\rho q_{rai}$</span>, and   <span>$\rho q_{sno}$</span>state variables. For the conservation equation for <a href="https://clima.github.io/ClimateMachine.jl/latest/Theory/Atmos/AtmosModel/#Energy">total energy</a>   the source term due to microphysics processes is caused by   either removing cloud condensate outside of the working fluid   or by changing phase and releasing latent heat outside of the working fluid. Below, contributions from different microphysics processes are listed:\
The contribution from   cloud liquid water to rain autoconversion,   cloud liquid water accretion by rain,   and rain evaporation   is computed as:</p><p class="math-container">\[\begin{equation}
\left. \mathcal{S}_{\rho e} \right|_{precip} =
  - (I_l + \Phi) \rho \, \mathcal{S}_{q_{rai}}
\end{equation}\]</p><p>where:</p><ul><li><span>$I_l = c_{vl} (T - T_0)$</span> is the internal energy of liquid water,</li><li><span>$T$</span> is the temperature,</li><li><span>$T_0$</span> is the thermodynamic reference temperature (which is unrelated to the reference temperature used in hydrostatic reference states used in the momentum equations),</li><li><span>$c_{vl}$</span> is the isochoric specific heat of liquid water,</li><li><span>$\Phi$</span> is the effective gravitational potential.</li><li><span>$\mathcal{S}_{q_{rai}}$</span> is the source of rain from the above three processes.</li></ul><p>The contribution from   cloud ice to snow autoconversion,   cloud ice accretion by snow,   cloud liquid accretion by snow in temperatures below freezing,   and snow deposition/sublimation   is computed as:</p><p class="math-container">\[\begin{equation}
\left. \mathcal{S}_{\rho e} \right|_{precip} =
  - (I_i + \Phi) \rho \, \mathcal{S}_{q_{sno}}
\end{equation}\]</p><p>where:</p><ul><li><span>$I_i = c_{vi} (T - T_0) - I_{i0}$</span> is the internal energy of ice,</li><li><span>$c_{vi}$</span> is the isochoric specific heat of ice,</li><li><span>$I_{i0}$</span> is the difference in specific internal energy between ice and liquid at <span>$T_0$</span>,</li><li><span>$\mathcal{S}_{q_{sno}}$</span> is the source of snow from the above four processes.</li></ul><p>The contribution from   accretion of cloud liquid water by snow in temperatures above freezing   is computed as:</p><p class="math-container">\[\begin{equation}
\left. \mathcal{S}_{\rho e} \right|_{precip} =
  ((1 + \alpha) I_l - \alpha I_i + \Phi) \rho \, \mathcal{S}_{q_{liq}}
\end{equation}\]</p><p>where:</p><ul><li><span>$\alpha = \frac{c_{vl}}{L_f}(T - T_{freeze})$</span></li><li><span>$\mathcal{S}_{q_{liq}}$</span> is the source of cloud liquid water from</li></ul><p>accretion of cloud liquid water by snow in temperatures above freezing. The contribution from cloud ice accretion by rain (the result is snow)   is computed as:</p><p class="math-container">\[\begin{equation}
\left. \mathcal{S}_{\rho e} \right|_{precip} =
   (I_i + \Phi) \rho \, \mathcal{S}_{q_{ice}} - \rho L_f \mathcal{S}_{q_{rai}}
\end{equation}\]</p><p>where:</p><ul><li><span>$\mathcal{S}_{q_{ice}}$</span> and <span>$\mathcal{S}_{q_{rai}}$</span></li></ul><p>are the sinks of cloud ice and rain due to accretion.. Finally, the contribution from accretion between rain and snow   as well as snow melting into rain is computed as:</p><p class="math-container">\[\begin{equation}
\left. \mathcal{S}_{\rho e} \right|_{precip} =
   \rho L_f \mathcal{S}_{q_{sno}}
\end{equation}\]</p><p>where:</p><ul><li><span>$\mathcal{S}_{q_{sno}}$</span> is the source of snow in those two processes.</li></ul><h2 id="Example-figures"><a class="docs-heading-anchor" href="#Example-figures">Example figures</a><a id="Example-figures-1"></a><a class="docs-heading-anchor-permalink" href="#Example-figures" title="Permalink"></a></h2><pre><code class="language-julia">using Plots

using ClimateMachine.Microphysics
using ClimateMachine.Thermodynamics

using CLIMAParameters
using CLIMAParameters.Planet: R_d, planet_radius, grav, MSLP, molmass_ratio
using CLIMAParameters.Atmos.Microphysics
struct EarthParameterSet &lt;: AbstractEarthParameterSet end
struct LiquidParameterSet &lt;: AbstractLiquidParameterSet end
struct RainParameterSet &lt;: AbstractRainParameterSet end
struct IceParameterSet &lt;: AbstractIceParameterSet end
struct SnowParameterSet &lt;: AbstractSnowParameterSet end

const param_set = EarthParameterSet()
const liquid_param_set = LiquidParameterSet()
const rain_param_set = RainParameterSet()
const ice_param_set = IceParameterSet()
const snow_param_set = SnowParameterSet()

# eq. 5d in [Grabowski1996](@cite)
function terminal_velocity_empirical(q_rai::DT, q_tot::DT, ρ::DT, ρ_air_ground::DT) where {DT&lt;:Real}
    rr  = q_rai / (DT(1) - q_tot)
    vel = DT(14.34) * ρ_air_ground^DT(0.5) * ρ^-DT(0.3654) * rr^DT(0.1346)
    return vel
end

# eq. 5b in [Grabowski1996](@cite)
function accretion_empirical(q_rai::DT, q_liq::DT, q_tot::DT) where {DT&lt;:Real}
    rr  = q_rai / (DT(1) - q_tot)
    rl  = q_liq / (DT(1) - q_tot)
    return DT(2.2) * rl * rr^DT(7/8)
end

# eq. 5c in [Grabowski1996](@cite)
function rain_evap_empirical(q_rai::DT, q::PhasePartition, T::DT, p::DT, ρ::DT) where {DT&lt;:Real}

    ts_neq = PhaseNonEquil_ρTq(param_set, ρ, T, q)
    q_sat  = q_vap_saturation(ts_neq)
    q_vap  = q.tot - q.liq
    rr     = q_rai / (DT(1) - q.tot)
    rv_sat = q_sat / (DT(1) - q.tot)
    S      = q_vap/q_sat - DT(1)

    ag, bg = 5.4 * 1e2, 2.55 * 1e5
    G = DT(1) / (ag + bg / p / rv_sat) / ρ

    av, bv = 1.6, 124.9
    F = av * (ρ/DT(1e3))^DT(0.525)  * rr^DT(0.525) + bv * (ρ/DT(1e3))^DT(0.7296) * rr^DT(0.7296)

    return DT(1) / (DT(1) - q.tot) * S * F * G
end

# example values
q_liq_range  = range(1e-8, stop=5e-3, length=100)
q_ice_range  = range(1e-8, stop=5e-3, length=100)
q_rain_range = range(1e-8, stop=5e-3, length=100)
q_snow_range = range(1e-8, stop=5e-3, length=100)
ρ_air, ρ_air_ground = 1.2, 1.22
q_liq, q_ice, q_tot = 5e-4, 5e-4, 20e-3

plot( q_rain_range * 1e3, [terminal_velocity(param_set, rain_param_set, ρ_air, q_rai) for q_rai in q_rain_range],     linewidth=3, xlabel=&quot;q_rain or q_snow [g/kg]&quot;, ylabel=&quot;terminal velocity [m/s]&quot;, label=&quot;Rain-CLIMA&quot;)
plot!(q_snow_range * 1e3, [terminal_velocity(param_set, snow_param_set, ρ_air, q_sno) for q_sno in q_snow_range],     linewidth=3, label=&quot;Snow-CLIMA&quot;)
plot!(q_rain_range * 1e3, [terminal_velocity_empirical(q_rai, q_tot, ρ_air, ρ_air_ground) for q_rai in q_rain_range], linewidth=3, label=&quot;Rain-Empirical&quot;)

T = 273.15
plot( q_liq_range * 1e3, [conv_q_liq_to_q_rai(rain_param_set, q_liq) for q_liq in q_liq_range], linewidth=3, xlabel=&quot;q_liq or q_ice [g/kg]&quot;, ylabel=&quot;autoconversion rate [1/s]&quot;, label=&quot;Rain&quot;)
plot!(q_ice_range * 1e3, [conv_q_ice_to_q_sno(param_set, ice_param_set, PhasePartition(q_tot, 0., q_ice), ρ_air, T-5)  for q_ice in q_ice_range], linewidth=3, label=&quot;Snow T=-5C&quot;)
plot!(q_ice_range * 1e3, [conv_q_ice_to_q_sno(param_set, ice_param_set, PhasePartition(q_tot, 0., q_ice), ρ_air, T-10) for q_ice in q_ice_range], linewidth=3, label=&quot;Snow T=-15C&quot;)
plot!(q_ice_range * 1e3, [conv_q_ice_to_q_sno(param_set, ice_param_set, PhasePartition(q_tot, 0., q_ice), ρ_air, T-15) for q_ice in q_ice_range], linewidth=3, label=&quot;Snow T=-25C&quot;)

plot( q_rain_range * 1e3, [accretion(param_set, liquid_param_set, rain_param_set, q_liq, q_rai, ρ_air) for q_rai in q_rain_range], linewidth=3, xlabel=&quot;q_rain or q_snow [g/kg]&quot;, ylabel=&quot;accretion rate [1/s]&quot;, label=&quot;Liq+Rain-CLIMA&quot;)
plot!(q_rain_range * 1e3, [accretion(param_set, ice_param_set,    rain_param_set, q_ice, q_rai, ρ_air) for q_rai in q_rain_range], linewidth=3, label=&quot;Ice+Rain-CLIMA&quot;)
plot!(q_snow_range * 1e3, [accretion(param_set, liquid_param_set, snow_param_set, q_liq, q_sno, ρ_air) for q_sno in q_snow_range], linewidth=3, label=&quot;Liq+Snow-CLIMA&quot;)
plot!(q_snow_range * 1e3, [accretion(param_set, ice_param_set,    snow_param_set, q_ice, q_sno, ρ_air) for q_sno in q_snow_range], linewidth=4, linestyle=:dash, label=&quot;Ice+Snow-CLIMA&quot;)
plot!(q_rain_range * 1e3, [accretion_empirical(q_rai, q_liq, q_tot) for q_rai in q_rain_range], linewidth=3, label=&quot;Liq+Rain-Empirical&quot;)

q_ice = 1e-6
plot(q_rain_range * 1e3, [accretion_rain_sink(param_set, ice_param_set, rain_param_set, q_ice, q_rai, ρ_air) for q_rai in q_rain_range], linewidth=3, xlabel=&quot;q_rain or q_snow [g/kg]&quot;, ylabel=&quot;accretion rain sink rate [1/s]&quot;, label=&quot;q_ice=1e-6&quot;)
q_ice = 1e-5
plot!(q_rain_range * 1e3, [accretion_rain_sink(param_set, ice_param_set, rain_param_set, q_ice, q_rai, ρ_air) for q_rai in q_rain_range], linewidth=3, xlabel=&quot;q_rain or q_snow [g/kg]&quot;, ylabel=&quot;accretion rain sink rate [1/s]&quot;, label=&quot;q_ice=1e-5&quot;)
q_ice = 1e-4
plot!(q_rain_range * 1e3, [accretion_rain_sink(param_set, ice_param_set, rain_param_set, q_ice, q_rai, ρ_air) for q_rai in q_rain_range], linewidth=3, xlabel=&quot;q_rain or q_snow [g/kg]&quot;, ylabel=&quot;accretion rain sink rate [1/s]&quot;, label=&quot;q_ice=1e-4&quot;)

q_sno = 1e-6
plot(q_rain_range * 1e3, [accretion_snow_rain(param_set, rain_param_set, snow_param_set, q_rai, q_sno, ρ_air) for q_rai in q_rain_range], linewidth=3, xlabel=&quot;q_rain [g/kg]&quot;, ylabel=&quot;snow-rain accretion rate [1/s] T&gt;0&quot;, label=&quot;q_snow=1e-6&quot;)
q_sno = 1e-5
plot!(q_rain_range * 1e3, [accretion_snow_rain(param_set, rain_param_set, snow_param_set, q_rai, q_sno, ρ_air) for q_rai in q_rain_range], linewidth=3, label=&quot;q_snow=1e-5&quot;)
q_sno = 1e-4
plot!(q_rain_range * 1e3, [accretion_snow_rain(param_set, rain_param_set, snow_param_set, q_rai, q_sno, ρ_air) for q_rai in q_rain_range], linewidth=3, label=&quot;q_snow=1e-4&quot;)

q_rai = 1e-6
plot(q_snow_range * 1e3, [accretion_snow_rain(param_set, snow_param_set, rain_param_set, q_sno, q_rai, ρ_air) for q_sno in q_snow_range], linewidth=3, xlabel=&quot;q_snow [g/kg]&quot;, ylabel=&quot;snow-rain accretion rate [1/s] T&lt;0&quot;, label=&quot;q_rain=1e-6&quot;)
q_rai = 1e-5
plot!(q_snow_range * 1e3, [accretion_snow_rain(param_set, snow_param_set, rain_param_set, q_sno, q_rai, ρ_air) for q_sno in q_snow_range], linewidth=3, label=&quot;q_rain=1e-5&quot;)
q_rai = 1e-4
plot!(q_snow_range * 1e3, [accretion_snow_rain(param_set, snow_param_set, rain_param_set, q_sno, q_rai, ρ_air) for q_sno in q_snow_range], linewidth=3, label=&quot;q_rain=1e-4&quot;)

# example values
T, p = 273.15 + 15, 90000.
ϵ = 1. / molmass_ratio(param_set)
p_sat = saturation_vapor_pressure(param_set, T, Liquid())
q_sat = ϵ * p_sat / (p + p_sat * (ϵ - 1.))
q_rain_range = range(1e-8, stop=5e-3, length=100)
q_tot = 15e-3
q_vap = 0.15 * q_sat
q_ice = 0.
q_liq = q_tot - q_vap - q_ice
q = PhasePartition(q_tot, q_liq, q_ice)
R = gas_constant_air(param_set, q)
ρ = p / R / T

plot(q_rain_range * 1e3,  [evaporation_sublimation(param_set, rain_param_set, q, q_rai, ρ, T) for q_rai in q_rain_range], xlabel=&quot;q_rain [g/kg]&quot;, linewidth=3, ylabel=&quot;rain evaporation rate [1/s]&quot;, label=&quot;ClimateMachine&quot;)
plot!(q_rain_range * 1e3, [rain_evap_empirical(q_rai, q, T, p, ρ) for q_rai in q_rain_range], linewidth=3, label=&quot;empirical&quot;)

# example values
T, p = 273.15 - 15, 90000.
ϵ = 1. / molmass_ratio(param_set)
p_sat = saturation_vapor_pressure(param_set, T, Ice())
q_sat = ϵ * p_sat / (p + p_sat * (ϵ - 1.))
q_snow_range = range(1e-8, stop=5e-3, length=100)
q_tot = 15e-3
q_vap = 0.15 * q_sat
q_liq = 0.
q_ice = q_tot - q_vap - q_ice
q = PhasePartition(q_tot, q_liq, q_ice)
R = gas_constant_air(param_set, q)
ρ = p / R / T

plot(q_snow_range * 1e3,  [evaporation_sublimation(param_set, snow_param_set, q, q_sno, ρ, T) for q_sno in q_snow_range], xlabel=&quot;q_snow [g/kg]&quot;, linewidth=3, ylabel=&quot;snow deposition sublimation rate [1/s]&quot;, label=&quot;T&lt;0&quot;)

T, p = 273.15 + 15, 90000.
ϵ = 1. / molmass_ratio(param_set)
p_sat = saturation_vapor_pressure(param_set, T, Ice())
q_sat = ϵ * p_sat / (p + p_sat * (ϵ - 1.))
q_snow_range = range(1e-8, stop=5e-3, length=100)
q_tot = 15e-3
q_vap = 0.15 * q_sat
q_liq = 0.
q_ice = q_tot - q_vap - q_ice
q = PhasePartition(q_tot, q_liq, q_ice)
R = gas_constant_air(param_set, q)
ρ = p / R / T

plot!(q_snow_range * 1e3,  [evaporation_sublimation(param_set, snow_param_set, q, q_sno, ρ, T) for q_sno in q_snow_range], xlabel=&quot;q_snow [g/kg]&quot;, linewidth=3, ylabel=&quot;snow deposition sublimation rate [1/s]&quot;, label=&quot;T&gt;0&quot;)

T=273.15
plot( q_snow_range * 1e3,  [snow_melt(param_set, snow_param_set, q_sno, ρ, T+2) for q_sno in q_snow_range], xlabel=&quot;q_snow [g/kg]&quot;, linewidth=3, ylabel=&quot;snow melt rate [1/s]&quot;, label=&quot;T=2C&quot;)
plot!(q_snow_range * 1e3,  [snow_melt(param_set, snow_param_set, q_sno, ρ, T+4) for q_sno in q_snow_range], xlabel=&quot;q_snow [g/kg]&quot;, linewidth=3, label=&quot;T=4C&quot;)
plot!(q_snow_range * 1e3,  [snow_melt(param_set, snow_param_set, q_sno, ρ, T+6) for q_sno in q_snow_range], xlabel=&quot;q_snow [g/kg]&quot;, linewidth=3, label=&quot;T=6C&quot;)</code></pre><p><img src="../terminal_velocity.svg" alt/> <img src="../autoconversion_rate.svg" alt/> <img src="../accretion_rate.svg" alt/> <img src="../accretion_rain_sink_rate.svg" alt/> <img src="../accretion_snow_rain_below_freeze.svg" alt/> <img src="../accretion_snow_rain_above_freeze.svg" alt/> <img src="../rain_evaporation_rate.svg" alt/> <img src="../snow_sublimation_deposition_rate.svg" alt/> <img src="../snow_melt_rate.svg" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Microphysics_0M/">« Microphysics_0M</a><a class="docs-footer-nextpage" href="../EDMFEquations/">EDMF equations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 17 December 2020 20:02">Thursday 17 December 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

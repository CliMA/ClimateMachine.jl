<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Microphysics · ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Atmos/heldsuarez/">Dry Idealized GCM</a></li><li><a class="tocitem" href="../../../generated/Atmos/risingbubble/">Rising Thermal Bubble</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-1"><span class="docs-label">Heat</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Land/Heat/heat_equation/">Heat Equation</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-4-1" type="checkbox"/><label class="tocitem" for="menuitem-3-4-1"><span class="docs-label">LinearSolvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Numerics/LinearSolvers/cg/">Conjugate Gradient</a></li><li><a class="tocitem" href="../../../generated/Numerics/LinearSolvers/bgmres/">Batched Generalized Minimal Residual</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Contributing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/literate_markdown/">Notes on Literate</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Common/MoistThermodynamics/">MoistThermodynamics</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Atmos/TemperatureProfiles/">TemperatureProfiles</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-5-2" type="checkbox"/><label class="tocitem" for="menuitem-4-5-2"><span class="docs-label">DG methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/DGmethods/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-3" type="checkbox"/><label class="tocitem" for="menuitem-4-5-3"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-4" type="checkbox"/><label class="tocitem" for="menuitem-4-5-4"><span class="docs-label">Linear Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/LinearSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/">Home</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../APIs/Atmos/Microphysics/">Microphysics</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li></ul></li><li><a class="tocitem" href="../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Diagnostics/Diagnostics/">List of variables</a></li><li><a class="tocitem" href="../../../APIs/Diagnostics/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-8" type="checkbox"/><label class="tocitem" for="menuitem-5-8"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../APIs/Numerics/LinearSolvers/LinearSolvers/">LinearSolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGmethods/BalanceLawOverview/">Balance Law</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox" checked/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Common/SurfaceFluxes/">SurfaceFluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox" checked/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../AtmosModel/">AtmosModel</a></li><li class="is-active"><a class="tocitem" href>Microphysics</a><ul class="internal"><li><a class="tocitem" href="#Rain-drop-size-distribution-1"><span>Rain drop size distribution</span></a></li><li><a class="tocitem" href="#Terminal-velocity-1"><span>Terminal velocity</span></a></li><li><a class="tocitem" href="#Cloud-condensation/evaporation-1"><span>Cloud condensation/evaporation</span></a></li><li><a class="tocitem" href="#Autoconversion-1"><span>Autoconversion</span></a></li><li><a class="tocitem" href="#Accretion-1"><span>Accretion</span></a></li><li><a class="tocitem" href="#Rain-evaporation-1"><span>Rain evaporation</span></a></li><li><a class="tocitem" href="#References-1"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../Model/turbulence/">Turbulence</a></li><li><a class="tocitem" href="../Model/tracers/">Tracers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../DevDocs/VariableList/">Variable list</a></li><li><a class="tocitem" href="../../../DevDocs/DiagnosticVariables/">Diagnostic variable list</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li><a class="is-disabled">Atmos</a></li><li class="is-active"><a href>Microphysics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Microphysics</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/blob/master/docs/src/Theory/Atmos/Microphysics.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Microphysics-Module-1"><a class="docs-heading-anchor" href="#Microphysics-Module-1">Microphysics Module</a><a class="docs-heading-anchor-permalink" href="#Microphysics-Module-1" title="Permalink"></a></h1><p>The <code>Microphysics</code> module describes warm rain bulk parameterization of cloud microphysical processes. The module describes the warm rain (no ice and snow) formation and is based on the ideas of Kessler 1995.</p><p>Parameterized processes include:</p><ul><li>rain sedimentation with mass weighted average terminal velocity,</li><li>condensation/evaporation of cloud water,</li><li>autoconversion,</li><li>accretion,</li><li>evaporation of rain water.</li></ul><p>The cloud microphysics variables are expressed as specific humidities:</p><ul><li>q_tot - total water specific humidity,</li><li>q_vap - water vapor specific humidity,</li><li>q_liq - liquid water specific humidity,</li><li>q_rai - rain water specific humidity.</li></ul><p>Parameters used in the parameterization are defined in <code>MicrophysicsParameters</code> module. They consist of:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">definition</th><th style="text-align: right">units</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$n_{0_{MP}}$</span></td><td style="text-align: right">rain drop size distribution parameter</td><td style="text-align: right"><span>$\frac{1}{m^4}$</span></td><td style="text-align: right"><span>$16 \cdot 10^6$</span></td></tr><tr><td style="text-align: right"><span>$\tau_{cond_evap}$</span></td><td style="text-align: right">cloud water condensation/evaporation timescale</td><td style="text-align: right"><span>$s$</span></td><td style="text-align: right"><span>$10$</span></td></tr><tr><td style="text-align: right"><span>$\tau_{acnv}$</span></td><td style="text-align: right">cloud to rain water autoconversion timescale</td><td style="text-align: right"><span>$s$</span></td><td style="text-align: right"><span>$10^3$</span></td></tr><tr><td style="text-align: right"><span>$q_{liq\_threshold}$</span></td><td style="text-align: right">cloud to rain water autoconversion threshold</td><td style="text-align: right">-</td><td style="text-align: right"><span>$5 \cdot 10^{-4}$</span></td></tr><tr><td style="text-align: right"><span>$E_{col}$</span></td><td style="text-align: right">collision efficiency between rain drops and cloud droplets</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.8$</span></td></tr><tr><td style="text-align: right"><span>$C_{drag}$</span></td><td style="text-align: right">rain drop drag coefficient</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.55$</span></td></tr><tr><td style="text-align: right"><span>$a_{vent}, b_{vent}$</span></td><td style="text-align: right">rain drop ventilation factor coefficients</td><td style="text-align: right">-</td><td style="text-align: right"><span>$1.5 \;$</span>,<span>$\; 0.53$</span></td></tr><tr><td style="text-align: right"><span>$K_{therm}$</span></td><td style="text-align: right">thermal conductivity of air</td><td style="text-align: right"><span>$\frac{J}{m \; s \; K}$</span></td><td style="text-align: right"><span>$2.4 \cdot 10^{-2}$</span></td></tr><tr><td style="text-align: right"><span>$\nu_{air}$</span></td><td style="text-align: right">kinematic viscosity of air</td><td style="text-align: right"><span>$\frac{m^2}{s}$</span></td><td style="text-align: right"><span>$1.6 \cdot 10^{-5}$</span></td></tr><tr><td style="text-align: right"><span>$D_{vapor}$</span></td><td style="text-align: right">diffusivity of water vapor</td><td style="text-align: right"><span>$\frac{m^2}{s}$</span></td><td style="text-align: right"><span>$2.26 \cdot 10^{-5}$</span></td></tr></table><h2 id="Rain-drop-size-distribution-1"><a class="docs-heading-anchor" href="#Rain-drop-size-distribution-1">Rain drop size distribution</a><a class="docs-heading-anchor-permalink" href="#Rain-drop-size-distribution-1" title="Permalink"></a></h2><p>The rain-drop size distribution is assumed to follow Marshall-Palmer distribution (Marshall Palmer 1948 eq. 1):</p><div>\[\begin{equation}
n(r) = n_{0_{MP}} exp\left(- \lambda_{MP} \, r \right)
\end{equation}\]</div><p>where:</p><ul><li><span>$r$</span> is the drop radius,</li><li><span>$n_{0_{MP}}$</span> and <span>$\lambda_{MP}$</span> are the Marshall-Palmer distribution</li></ul><p>parameters (twice the values used in the Marshall Palmer 1948, because  we use drop radius and not diameter).</p><h2 id="Terminal-velocity-1"><a class="docs-heading-anchor" href="#Terminal-velocity-1">Terminal velocity</a><a class="docs-heading-anchor-permalink" href="#Terminal-velocity-1" title="Permalink"></a></h2><p>The terminal velocity of an individual rain drop is defined by the balance between the gravitational acceleration (taking into account the density difference between water and air) and the drag force:</p><div>\[\begin{equation}
v_{drop} = \left(\frac{8}{3 \, C_{drag}} \left( \frac{\rho_{water}}{\rho} -1 \right) \right)^{1/2} (g \, r)^{1/2} = v_c(\rho) \, (g \, r)^{1/2}
\label{eq:vdrop}
\end{equation}\]</div><p>where:</p><ul><li><span>$g$</span> is the gravitational acceleration,</li><li><span>$C_{drag}$</span> is the drag coefficient,</li><li><span>$\rho_{water}$</span> is the density of water,</li><li><span>$\rho$</span> is the density of air.</li></ul><p>The mass weighted terminal velocity <span>$v_t$</span> is defined following Ogura and Takahashi 1971</p><div>\[\begin{equation}
v_t = \frac{F_{rain}}{RWC}
\label{eq:vt}
\end{equation}\]</div><p>where:</p><ul><li><span>$F_{rain} = \int_0^\infty n(r) \, m(r) \, v_{drop}(r) \, dr$</span> is the</li></ul><p>vertical flux of rain drops,</p><ul><li><span>$RWC = \int_0^\infty n(r) \, m(r) \, dr = \rho \, q_{rai}$</span> is the</li></ul><p>rain water content.</p><p>Integrating over the assumed Marshall-Palmer distribution results in</p><div>\[\begin{equation}
RWC = \frac{8 \pi \, n_{0_{MP}} \, \rho_{water}}{\lambda_{MP}^4}
\label{eq:lambda}
\end{equation}\]</div><div>\[\begin{equation}
F_{rain} = \Gamma \left(\frac{9}{2} \right) \frac{4}{3} n_{0_{MP}} \, \pi \, \rho_{water} v_c(\rho) \, g^{1/2} (\lambda_{MP})^{-9/2}
\label{eq:frain}
\end{equation}\]</div><p>Substituting eq.(\ref{eq:lambda}) and eq.(\ref{eq:frain}) into eq.(\ref{eq:vt}) results in:</p><div>\[\begin{equation}
v_t = \Gamma \left( \frac{9}{2} \right) \, \frac{v_c(\rho)}{6} \, \left( \frac{g}{\lambda_{MP}}\right)^{1/2}
\end{equation}\]</div><p>where <span>$\lambda_{MP}$</span> is computed as</p><div>\[\lambda_{MP} = \left( \frac{8 \pi \rho_{water} n_{0_{MP}}}{\rho q_{rai}} \right)^{1/4}\]</div><p>The default value of <span>$C_{drag}$</span> is chosen such that the <span>$v_t$</span> is close to the empirical terminal velocity formulation in Smolarkiewicz and Grabowski 1996. Assuming a constant drag coefficient is an approximation as it should be size and flow dependent, see <a href="https://www.grc.nasa.gov/www/K-12/airplane/dragsphere.html">drag_coefficient</a>.</p><pre><code class="language-julia">using ClimateMachine.Microphysics
using Plots
using CLIMAParameters
using CLIMAParameters.Atmos.Microphysics
struct EarthParameterSet &lt;: AbstractEarthParameterSet end
const param_set = EarthParameterSet()

# eq. 5d in Smolarkiewicz and Grabowski 1996
# https://doi.org/10.1175/1520-0493(1996)124&lt;0487:TTLSLM&gt;2.0.CO;2
function terminal_velocity_empirical(q_rai::DT, q_tot::DT, ρ::DT, ρ_air_ground::DT) where {DT&lt;:Real}
    rr  = q_rai / (DT(1) - q_tot)
    vel = DT(14.34) * ρ_air_ground^DT(0.5) * ρ^-DT(0.3654) * rr^DT(0.1346)
    return vel
end

q_rain_range = range(1e-8, stop=5e-3, length=100)
ρ_air, q_tot, ρ_air_ground = 1.2, 20 * 1e-3, 1.22

plot(q_rain_range * 1e3,  [terminal_velocity(param_set, q_rai, ρ_air) for q_rai in q_rain_range], xlabel=&quot;q_rain [g/kg]&quot;, ylabel=&quot;velocity [m/s]&quot;, title=&quot;Average terminal velocity of rain&quot;, label=&quot;ClimateMachine&quot;)
plot!(q_rain_range * 1e3, [terminal_velocity_empirical(q_rai, q_tot, ρ_air, ρ_air_ground) for q_rai in q_rain_range], label=&quot;Empirical&quot;)</code></pre><p><img src="../rain_terminal_velocity.svg" alt/></p><h2 id="Cloud-condensation/evaporation-1"><a class="docs-heading-anchor" href="#Cloud-condensation/evaporation-1">Cloud condensation/evaporation</a><a class="docs-heading-anchor-permalink" href="#Cloud-condensation/evaporation-1" title="Permalink"></a></h2><p>Condensation and evaporation of cloud water is parameterized as a relaxation to equilibrium value at the current time step.</p><div>\[\begin{equation}
  \left. \frac{d \, q_{liq}}{dt} \right|_{cond, evap} = \frac{q^{eq}_{liq} - q_{liq}}{\tau_{cond\_evap}}
\end{equation}\]</div><p>where:</p><ul><li><span>$q^{eq}_{liq}$</span> - liquid water specific humidity in equilibrium,</li><li><span>$q_{liq}$</span> - liquid water specific humidity,</li><li><span>$\tau_{cond\_evap}$</span> - relaxation timescale (parameter in</li></ul><p><code>MicrophysicsParameters</code> module).</p><h2 id="Autoconversion-1"><a class="docs-heading-anchor" href="#Autoconversion-1">Autoconversion</a><a class="docs-heading-anchor-permalink" href="#Autoconversion-1" title="Permalink"></a></h2><p>Autoconversion defines the rate of conversion form cloud to rain water due to collisions between cloud droplets. It is parameterized following Kessler 1995:</p><div>\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{acnv} = \frac{max(0, q_{liq} - q_{liq\_threshold})}{\tau_{acnv}}
\end{equation}\]</div><p>where:</p><ul><li><span>$q_{liq}$</span> - liquid water specific humidity,</li><li><span>$\tau_{acnv}$</span> - timescale (parameter in <code>MicrophysicsParameters</code></li></ul><p>module),</p><ul><li><span>$q_{liq\_threshold}$</span> - autoconversion (parameter in</li></ul><p><code>MicrophysicsParameters</code> module).</p><p>The default values of <span>$\tau_{acnv}$</span> and <span>$q_{liq\_threshold}$</span> are based on Smolarkiewicz and Grabowski 1996.</p><h2 id="Accretion-1"><a class="docs-heading-anchor" href="#Accretion-1">Accretion</a><a class="docs-heading-anchor-permalink" href="#Accretion-1" title="Permalink"></a></h2><p>Accretion defines the rate of conversion from cloud to rain water resulting from collisions between cloud droplets and rain drops. It is parameterized following Kessler 1995:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{accr} = \int_0^\infty n(r) \, \pi r^2 \, v_{drop} E_{col} q_{liq} dr
\end{equation}\]</div><p>where:</p><ul><li><span>$E_{col}$</span> is the collision efficiency,</li><li><span>$v_{drop}$</span> is defined in eq.(\ref{eq:vdrop}).</li></ul><p>Integrating over the distribution and using the RWC to eliminate the <span>$\lambda_{MP}$</span> results in:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{accr}  = \Gamma \left(\frac{7}{2} \right) \pi^{1/8} 8^{-7/8} E_{col} v_c(\rho) \, \left(\frac{\rho}{\rho_{water}}\right)^{7/8} n_{0_{MP}}^{1/8} g^{1/2} q_{liq} q_{rai}^{7/8} = A(\rho) \, n_{0_{MP}}^{1/8} g^{1/2} q_{liq} q_{rai}^{7/8}
\end{equation}\]</div><p>The default value of collision efficiency <span>$E_{coll}$</span> is set to 0.8 so that the resulting accretion rate is close to the empirical accretion rate in Smolarkiewicz and Grabowski 1996. Assuming a constant <span>$E_{col}$</span> is an approximation, see for example <a href="https://journals.ametsoc.org/doi/10.1175/1520-0469%282001%29058%3C0742%3ACEODIA%3E2.0.CO%3B2">collision efficiency</a>.</p><pre><code class="language-julia">using ClimateMachine.Microphysics
using Plots
using CLIMAParameters
struct EarthParameterSet &lt;: AbstractEarthParameterSet end
const param_set = EarthParameterSet()

# eq. 5b in Smolarkiewicz and Grabowski 1996
# https://doi.org/10.1175/1520-0493(1996)124&lt;0487:TTLSLM&gt;2.0.CO;2
function accretion_empirical(q_rai::DT, q_liq::DT, q_tot::DT) where {DT&lt;:Real}
    rr  = q_rai / (DT(1) - q_tot)
    rl  = q_liq / (DT(1) - q_tot)
    return DT(2.2) * rl * rr^DT(7/8)
end

# some example values
q_rain_range = range(1e-8, stop=5e-3, length=100)
ρ_air, q_liq, q_tot = 1.2, 5e-4, 20e-3

plot(q_rain_range * 1e3,  [conv_q_liq_to_q_rai_accr(param_set, q_liq, q_rai, ρ_air) for q_rai in q_rain_range], xlabel=&quot;q_rain [g/kg]&quot;, ylabel=&quot;accretion rate [1/s]&quot;, title=&quot;Accretion&quot;, label=&quot;ClimateMachine&quot;)
plot!(q_rain_range * 1e3, [accretion_empirical(q_rai, q_liq, q_tot) for q_rai in q_rain_range], label=&quot;empirical&quot;)</code></pre><p><img src="../accretion_rate.svg" alt/></p><h2 id="Rain-evaporation-1"><a class="docs-heading-anchor" href="#Rain-evaporation-1">Rain evaporation</a><a class="docs-heading-anchor-permalink" href="#Rain-evaporation-1" title="Permalink"></a></h2><p>Based on Maxwell 1971 the equation of growth of individual water drop is:</p><div>\[\begin{equation}

r \frac{dr}{dt} = \frac{1}{\rho_{water}}
                  \left(\frac{q_{vap}}{q_{vap}^{sat}} - 1 \right)
                  \left(
                    \frac{L}{KT} \left(\frac{L}{R_v T} - 1 \right) +
                    \frac{R_v T}{p_{vap}^{sat} D}
                  \right)^{-1}
                = \frac{1}{\rho_{water}} S(q_{vap}, q_{vap}^{sat}) \, G(T)
\end{equation}\]</div><p>where:</p><ul><li><span>$q_{vap}^{sat}$</span> is the saturation vapor specific humidity,</li><li><span>$L$</span> is the latent heat of vaporization,</li><li><span>$K_{thermo}$</span> is the thermal conductivity of air,</li><li><span>$R_v$</span> is the gas constant of water vapor,</li><li><span>$D_{vapor}$</span> is the diffusivity of water vapor,</li><li><span>$S(q_{vap}, q_{vap}^{sat}) = \frac{q_{vap}}{q_{vap}^{sat}} - 1$</span></li></ul><p>is commonly labeled as supersaturation,</p><ul><li><span>$G(T) = \left(\frac{L}{KT} \left(\frac{L}{R_v T} - 1 \right) + \frac{R_v T}{p_{vap}^{sat} D} \right)^{-1}$</span></li></ul><p>combines the effects of thermal conductivity and water diffusivity.</p><p>The rate of <span>$q_{rai}$</span> evaporation is:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{evap}  =  \int_0^\infty \frac{1}{\rho} \, 4 \pi \, r \, S(q_{vap}, q_{vap}^{sat}) \, G(T) \, F(r) \, n(r) \, dr
\end{equation}\]</div><p>where:</p><ul><li><span>$F(r)$</span> is the rain drop ventilation factor.</li></ul><p>Following Seifert and Beheng 2006 eq. 24 the ventilation factor is defined as:</p><div>\[\begin{equation}
F(r) = a_{vent} + b_{vent}  N_{Sc}^{1/3} N_{Re}(r)^{1/2}
\end{equation}\]</div><p>where:</p><ul><li><span>$a_{vent}$</span>, <span>$b_{vent}$</span> are coefficients,</li><li><span>$N_{Sc}$</span> is the Schmidt number,</li><li><span>$N_{Re}$</span> is the Reynolds number of a falling rain drop.</li></ul><p>The Schmidt number is assumed constant:</p><div>\[N_{Sc} = \frac{\nu_{air}}{D_{vapor}}\]</div><p>where:</p><ul><li><span>$\nu_{air}$</span> is the kinematic viscosity of air.</li></ul><p>The Reynolds number of a rain drop is defined as:</p><div>\[N_{Re} = \frac{2 \, r \, v_{drop}(r, \rho)}{\nu_{air}} = \frac{2 v_c(\rho) \, g^{1/2} \, r^{3/2}}{\nu_{air}}\]</div><p>The final integral is:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{evap}  =  4 \pi S(q_{vap}, q_{vap}^{sat}) \frac{n_{0_{MP}} G(T)}{\rho}
                                                  \int_0^\infty \left( a_{vent} r + b_{vent} N_{Sc}^{1/3} (2 v_c(\rho))^{1/2} \frac{g^{1/4}}{\nu_{air}^{1/2}} r^{7/4} \right) exp(-\lambda_{MP} r) dr
\end{equation}\]</div><p>Integrating and eliminating <span>$\lambda_{MP}$</span> using eq.(\ref{eq:lambda}) results in:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{evap}  = S(q_{vap}, q_{vap}^{sat}) \frac{G(T) n_{0_{MP}}^{1/2}}{\rho} \left( A q_{rai}^{1/2} + B \frac{g^{1/4}}{n_{0_{MP}}^{3/16} \nu_{air}^{1/2}} q_{rai}^{11/16} \right)
\end{equation}\]</div><p>where:</p><ul><li><span>$A = (2 \pi)^{1/2} a_{vent} \left( \frac{\rho}{\rho_{water}} \right)^{1/2}$</span></li><li><span>$B = \Gamma\left(\frac{11}{4}\right) 2^{7/16} \pi^{5/16} b_{vent} N_{Sc}^{1/3} v_c(\rho)^{1/2} \left( \frac{\rho}{\rho_{water}} \right)^{11/16}$</span></li></ul><p>The values of <span>$a_{vent}$</span> and <span>$b_{vent}$</span> are chosen so that at <span>$q_{tot} = 15 g/kg$</span> and <span>$T=288K$</span> the resulting rain evaporation rate is close to the empirical rain evaporation rate from Smolarkiewicz and Grabowski 1996.</p><pre><code class="language-julia">using ClimateMachine.Microphysics
using ClimateMachine.MoistThermodynamics

using CLIMAParameters
using CLIMAParameters.Planet: R_d, planet_radius, grav, MSLP, molmass_ratio
struct EarthParameterSet &lt;: AbstractEarthParameterSet end
const param_set = EarthParameterSet()

using Plots

# eq. 5c in Smolarkiewicz and Grabowski 1996
# https://doi.org/10.1175/1520-0493(1996)124&lt;0487:TTLSLM&gt;2.0.CO;2
function rain_evap_empirical(q_rai::DT, q::PhasePartition, T::DT, p::DT, ρ::DT) where {DT&lt;:Real}

    ts_neq = TemperatureSHumNonEquil(param_set, T, ρ, q)
    q_sat  = q_vap_saturation(ts_neq)
    q_vap  = q.tot - q.liq
    rr     = q_rai / (DT(1) - q.tot)
    rv_sat = q_sat / (DT(1) - q.tot)
    S      = q_vap/q_sat - DT(1)

    ag, bg = 5.4 * 1e2, 2.55 * 1e5
    G = DT(1) / (ag + bg / p / rv_sat) / ρ

    av, bv = 1.6, 124.9
    F = av * (ρ/DT(1e3))^DT(0.525)  * rr^DT(0.525) + bv * (ρ/DT(1e3))^DT(0.7296) * rr^DT(0.7296)

    return DT(1) / (DT(1) - q.tot) * S * F * G
end

# example values
T, p = 273.15 + 15, 90000.
ϵ = 1. / molmass_ratio(param_set)
p_sat = saturation_vapor_pressure(param_set, T, Liquid())
q_sat = ϵ * p_sat / (p + p_sat * (ϵ - 1.))
q_rain_range = range(1e-8, stop=5e-3, length=100)
q_tot = 15e-3
q_vap = 0.15 * q_sat
q_ice = 0.
q_liq = q_tot - q_vap - q_ice
q = PhasePartition(q_tot, q_liq, q_ice)
R = gas_constant_air(param_set, q)
ρ = p / R / T

plot(q_rain_range * 1e3,  [conv_q_rai_to_q_vap(param_set, q_rai, q, T, p, ρ) for q_rai in q_rain_range], xlabel=&quot;q_rain [g/kg]&quot;, ylabel=&quot;rain evaporation rate [1/s]&quot;, title=&quot;Rain evaporation&quot;, label=&quot;ClimateMachine&quot;)
plot!(q_rain_range * 1e3, [rain_evap_empirical(q_rai, q, T, p, ρ) for q_rai in q_rain_range], label=&quot;empirical&quot;)</code></pre><p><img src="../rain_evaporation_rate.svg" alt/></p><h2 id="References-1"><a class="docs-heading-anchor" href="#References-1">References</a><a class="docs-heading-anchor-permalink" href="#References-1" title="Permalink"></a></h2><p>@article{Grabowski<em>and</em>Smolarkiewicz_1996, author = {Grabowski, Wojciech W. and Smolarkiewicz, Piotr K.}, title = {Two-Time-Level Semi-Lagrangian Modeling of Precipitating Clouds}, journal = {Monthly Weather Review}, volume = {124}, number = {3}, pages = {487-497}, year = {1996}, doi = {10.1175/1520-0493(1996)124&lt;0487:TTLSLM&gt;2.0.CO;2}}</p><p>@article{Kessler_1995, author = {Kessler, E.}, title = {On the continuity and distribution of water substance in atmospheric circulations}, journal = {Atmospheric Research}, volume = {38}, number = {1}, pages = {109 - 145}, year = {1995}, doi = {10.1016/0169-8095(94)00090-Z}}</p><p>@book{Mason_1971, author = {Mason, B. J.}, title = {The Physics of Clouds}, publisher = {Oxford Univ. Press}, year = {1971}}</p><p>@article{Marshall<em>and</em>Palmer_1948, author = {Marshall, J. S. and Palmer, W. Mc K.}, title = {The distribution of raindrops with size}, journal = {Journal of Meteorology}, volume = {5}, number = {4}, pages = {165-166}, year = {1948}, doi = {10.1175/1520-0469(1948)005&lt;0165:TDORWS&gt;2.0.CO;2}}</p><p>@article{Ogura<em>and</em>Takahashi_1971, author = {Oqura, Yoshimitsu and Takahashi, Tsutomu}, title = {Numerical simulation of the life cycle of a thunderstorm cell}, journal = {Monthly Weather Review}, volume = {99}, number = {12}, pages = {895-911}, year = {1971}, doi = {10.1175/1520-0493(1971)099&lt;0895:NSOTLC&gt;2.3.CO;2}}</p><p>@article{Seifert<em>and</em>Beheng_2006, author={Seifert, A. and Beheng, K. D.}, title={A two-moment cloud microphysics parameterization for mixed-phase clouds. Part 1: Model description}, journal={Meteorology and Atmospheric Physics}, year={2006}, volume={92}, number={1}, pages={45–66}, doi={10.1007/s00703-005-0112-4}}</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../AtmosModel/">« AtmosModel</a><a class="docs-footer-nextpage" href="../EDMFEquations/">EDMF equations »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 27 May 2020 12:30">Wednesday 27 May 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
